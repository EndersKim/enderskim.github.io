import{am as O,G as k,o as i,d as m,e as s,an as K,p as D,f as A,n as z,a7 as Q,F as M,t as u,h,i as j,k as q,_ as U,x as W,ae as X,v as S,b as Y,a3 as tt,c as F,r as $,g as C,l as N,w as et}from"./index-3e0f4994.js";import{m as nt}from"./markdown_to_html_lite-855e1114.js";const P="fZodR9XQDSUm21yCkr6zBqiveYah8bt4xsWpHnJE7jL5VG3guMTKNPAwcF",Z={};for(let n=0;n<58;n++)Z[P[n]]=n;const H=[11,10,3,8,4,6],I=177451812,E=8728348608;function ot(n){n=(n^I)+E;var o="CM1  4 1 7  ".split("");for(let t=0;t<6;t++)o[H[t]]=P[Math.floor(n/Math.pow(58,t))%58];return o.join("")}function Ht(n){var o=0;for(let t=0;t<6;t++)o+=Z[n[H[t]]]*Math.pow(58,t);return o-E^I}const lt={class:"ZoomableImg"},at=["src","alt"],it=["src"],mt=s("div",{class:"full_view_overlay blur_part"},null,-1),ct=["src"],st={class:"full_img_box"},_t=["src"],rt={__name:"ZoomableImg",props:{src:{type:String,required:!0},alt:{type:String,default:"image"},border_radius:{type:String,default:"0"},fit:{type:String,default:"unset"}},setup(n){const o=n,t=O(),_=k("closed");let f=null;const l=k(null),x=k(null);function b(){const e=l.value.getBoundingClientRect(),a=x.value.getBoundingClientRect(),r={width:e.width,height:e.height,left:e.left,top:e.top,actual_width:e.width,actual_height:e.height,actual_left:e.left,actual_top:e.top,left_right_margin:0,top_bottom_margin:0},d=a.width/a.height,p=e.width/e.height;if(o.fit=="cover")if(d>p){const v=e.height*d,g=(v-e.width)/2;r.actual_width=v,r.left_right_margin=g,r.actual_left=e.left-g}else{const v=e.width/d,g=(v-e.height)/2;r.actual_height=v,r.top_bottom_margin=g,r.actual_top=e.top-g}return r}function w(){const e=x.value.getBoundingClientRect();return{width:e.width,height:e.height,left:e.left,top:e.top}}const y=k({}),c=k({});L();function L(){y.value={opacity:0},c.value={opacity:0}}function B(){const e=b(),a=w(),r=e.actual_left-a.left,d=e.actual_top-a.top,p=e.actual_width/a.width,v=e.actual_height/a.height,g={left:e.left_right_margin/p,right:e.left_right_margin/p,top:e.top_bottom_margin/v,bottom:e.top_bottom_margin/v};return{"clip-path":`inset(${g.top}px ${g.right}px ${g.bottom}px ${g.left}px round calc(${o.border_radius} / ${p}) )`,transform:`translate(${r}px, ${d}px) scale(${p}, ${v})`,width:a.width+"px",height:a.height+"px",left:a.left+"px",top:a.top+"px"}}function T(){const e=w();return{"clip-path":"inset(0 0 0 0 round 0)",transform:"translate(0, 0) scale(1, 1)",width:e.width+"px",height:e.height+"px",left:e.left+"px",top:e.top+"px"}}function R(){const e=b(),a=w(),r=a.width/e.actual_width,d=a.height/e.actual_height,p=a.left-e.actual_left,v=a.top-e.actual_top;return{left:-e.left_right_margin+"px",right:-e.left_right_margin+"px",top:-e.top_bottom_margin+"px",bottom:-e.top_bottom_margin+"px","clip-path":"inset(0 0 0 0 round 0)",transform:`translate(${p}px, ${v}px) scale(${r}, ${d})`}}function V(){const e=b(),a={left:e.left_right_margin,right:e.left_right_margin,top:e.top_bottom_margin,bottom:e.top_bottom_margin};return{left:-e.left_right_margin+"px",right:-e.left_right_margin+"px",top:-e.top_bottom_margin+"px",bottom:-e.top_bottom_margin+"px","clip-path":`inset(${a.top}px ${a.right}px ${a.bottom}px ${a.left}px round calc(${o.border_radius}) )`,transform:"translate(0, 0) scale(1, 1)"}}function G(){if(_.value==="opning"||_.value==="opened")return;const e=B(),a=T(),r=V(),d=R();y.value={opacity:0,...e},c.value={opacity:1,...r},requestAnimationFrame(()=>{y.value={transition:"0.3s, opacity 0.15s",opacity:1,...a},c.value={transition:"0.3s, opacity 0.15s 0.15s",opacity:0,...d}}),_.value="opening",clearTimeout(f),f=setTimeout(()=>{_.value="opened",L()},300)}function J(){if(_.value==="closing"||_.value==="closed")return;const e=B(),a=T(),r=R(),d=V();_.value==="opened"&&(y.value={opacity:1,...a},c.value={opacity:0,...r}),requestAnimationFrame(()=>{y.value={transition:"0.3s, opacity 0.15s 0.15s",opacity:0,...e},c.value={transition:"0.3s, opacity 0.15s",opacity:1,...d}}),_.value="closing",clearTimeout(f),f=setTimeout(()=>{_.value="closed",L()},300)}return(e,a)=>(i(),m("div",lt,[s("img",K({class:["small_img_item",_.value],ref_key:"small_img_el",ref:l,src:n.src,alt:n.alt,style:{objectFit:n.fit,clipPath:"inset(0 0 0 0 round "+n.border_radius+")"},onClick:G},D(t)),null,16,at),(i(),m("div",{key:0,class:A(["small_trans_box",_.value]),style:z(c.value)},[s("img",{class:"small_trans_item",src:n.src},null,8,it)],6)),s("div",{class:A(["zoomable_img_full",_.value]),onClick:J},[mt,(i(),m("div",{key:0,class:"full_trans_box",style:z(y.value)},[s("img",{class:"full_trans_item",src:n.src},null,8,ct)],4)),s("div",st,[s("img",{src:n.src,ref_key:"full_img_el",ref:x,class:"full_img_item"},null,8,_t)])],2)]))}};const ut={class:"CommentContent"},ht=["innerHTML"],dt=["textContent"],vt={key:1,class:"comment_content_attachments_space"},gt={class:"comment_attachment_item"},ft={__name:"CommentContent",props:{comment:Object},setup(n){const{comment:o}=n,t=k([]);return Q(()=>{if(o.attachments){let _=[];try{_=JSON.parse(o.attachments)}catch(f){console.log(f)}t.value=_}}),(_,f)=>(i(),m("div",ut,[n.comment.content?(i(),m(M,{key:0},[n.comment.md=="1"?(i(),m("div",{key:0,class:"comment_text_content",innerHTML:D(nt)(n.comment.content)},null,8,ht)):(i(),m("p",{key:1,class:"comment_text_content",textContent:u(n.comment.content)},null,8,dt))],64)):h("",!0),n.comment.content&&t.value.length>0?(i(),m("div",vt)):h("",!0),s("div",{class:A(["comment_attachments_box",{single_col:t.value.length==1,two_col:t.value.length>=2&&t.value.length<=4,three_col:t.value.length>=5}])},[(i(!0),m(M,null,j(t.value,l=>(i(),m("div",gt,[l.type=="image"?(i(),q(rt,{key:0,class:"comment_attachment_img",src:l.src,border_radius:"10px",fit:"cover"},null,8,["src"])):h("",!0)]))),256))],2)]))}};const yt={name:"Comment",components:{Avatar:W,Popper:X,CommentContent:ft},props:{comment:{},level:{default:1},options:{default:()=>({})}},computed:{is_self(){return S().active_character?S().active_character.cid==this.comment.character.cid:!1},is_admin(){var n;return Y().settings.active_admin?((n=S().active_character)==null?void 0:n.ctype)=="admin":!1},display_relative_time(){return tt(this.comment.insert_time)}},mounted(){this.$emit("loaded",this)},methods:{encode_comment_no(n){return ot(n)},reply_comment_event(n){this.$emit("reply_comment_event",n)},delete_comment_event(n,o){this.$emit("delete_comment_event",n,o)},view_user_event(n){this.$emit("view_user_event",n)},comment_loaded(n){this.$emit("loaded",n)},archor_event(n){this.$emit("archor_event",n)},comment_action_archor(){this.$emit("archor_event",this)},hightlight_parent_enter(){this.level>2&&(this.$parent.$refs.comment_main_box.classList.add("hightlight"),this.$refs.comment_reply_name.classList.add("hightlight"))},hightlight_parent_leave(){this.level>2&&(this.$parent.$refs.comment_main_box.classList.remove("hightlight"),this.$refs.comment_reply_name.classList.remove("hightlight"))},go_to_parent(){F(this.$parent.$el,!0)},hightlight_children_enter(){this.$refs.comment_reply_box.classList.add("reply_box_hightlight")},hightlight_children_leave(){this.$refs.comment_reply_box.classList.remove("reply_box_hightlight")},go_to_children(){F(this.$refs.comment_reply_box,!0)}}},pt=["level"],xt={class:"comment_box"},bt={key:0,class:"comment_avatar_section"},kt={class:"comment_main_section",ref:"comment_main_section"},wt=["level"],Ct={class:"comment_text_top"},Lt={class:"comment_name"},$t={key:0,class:"comment_name_reply"},Mt={class:"comment_time"},St={key:0,class:"comment_parent"},At={class:"comment_action"},Bt={key:0},Tt={class:"comment_action_transition"},Rt={key:0,class:"comment_action_transition"},Vt={key:1,class:"comment_action_transition"},zt={class:"comment_action_transition comment_action_archor"},Ft=["href"],Nt={key:3},Dt=["level"];function jt(n,o,t,_,f,l){const x=$("Avatar"),b=$("CommentContent"),w=$("router-link"),y=$("Comment",!0);return i(),m("div",{class:"comment",level:t.level},[s("div",xt,[t.level<=2?(i(),m("div",bt,[C(x,{avatar_url:t.comment.character.avatar_url,nickname:t.comment.character.nickname,size:40,class:"big_avatar",onClick:o[0]||(o[0]=c=>l.view_user_event(t.comment.character))},null,8,["avatar_url","nickname"]),C(x,{avatar_url:t.comment.character.avatar_url,nickname:t.comment.character.nickname,size:30,class:"small_avatar",onClick:o[1]||(o[1]=c=>l.view_user_event(t.comment.character))},null,8,["avatar_url","nickname"])])):h("",!0),s("div",kt,[s("div",{ref:"comment_main_box",class:"comment_main_box",level:t.level},[s("div",Ct,[s("div",Lt,[s("span",{class:"comment_name_span with_underline",onClick:o[2]||(o[2]=c=>l.view_user_event(t.comment.character))},u(t.comment.character.nickname),1),t.level>2||t.comment.parent?(i(),m("span",$t,u(n.$text("community.reply_to")),1)):h("",!0),t.level>2?(i(),m("span",{key:1,class:"comment_name_span_parent",ref:"comment_reply_name",onMouseenter:o[3]||(o[3]=c=>l.hightlight_parent_enter()),onMouseleave:o[4]||(o[4]=c=>l.hightlight_parent_leave()),onClick:o[5]||(o[5]=c=>l.go_to_parent())},u(n.$parent.comment.character.nickname),545)):h("",!0),t.comment.parent?(i(),m("span",{key:2,class:"comment_name_span_parent with_underline",onClick:o[6]||(o[6]=c=>l.view_user_event(t.comment.parent.character))},u(t.comment.parent.character.nickname),1)):h("",!0)]),s("span",Mt,u(t.comment.insert_time),1)]),t.comment.parent?(i(),m("div",St,[C(b,{comment:t.comment.parent},null,8,["comment"])])):h("",!0),C(b,{comment:t.comment},null,8,["comment"]),s("div",At,[s("p",null,u(l.display_relative_time),1),t.comment.md=="1"&&l.is_admin?(i(),m("p",Bt,"MD 格式")):h("",!0),t.comment.children?(i(),m("p",{key:1,class:"reply_count",onMouseenter:o[7]||(o[7]=c=>l.hightlight_children_enter()),onMouseleave:o[8]||(o[8]=c=>l.hightlight_children_leave()),onClick:o[9]||(o[9]=c=>l.go_to_children())},u(t.comment.children.length)+" "+u(t.comment.children.length==1?n.$text("community.reply"):n.$text("community.replies")),33)):h("",!0),t.options.hide_action?h("",!0):(i(),m(M,{key:2},[s("p",Tt,[s("a",{onClick:o[10]||(o[10]=c=>l.reply_comment_event(t.comment))},u(n.$text("community.reply")),1)]),l.is_self?(i(),m("p",Rt,[s("a",{onClick:o[11]||(o[11]=c=>l.delete_comment_event(t.comment,t.level))},u(n.$text("community.delete")),1)])):l.is_admin?(i(),m("p",Vt,[s("a",{onClick:o[12]||(o[12]=c=>l.delete_comment_event(t.comment,t.level))},u(n.$text("community.delete_others")),1)])):h("",!0),s("p",zt,[s("a",{href:"#"+l.encode_comment_no(t.comment.comment_no),onClick:o[13]||(o[13]=c=>l.comment_action_archor())},"#",8,Ft)])],64)),t.options.display_post&&t.comment.post?(i(),m("p",Nt,[N(u(n.$text("community.posted_on"))+" ",1),C(w,{to:"/"+t.comment.post.post_link.toLowerCase()+"#"+l.encode_comment_no(t.comment.comment_no)},{default:et(()=>[N(u(t.comment.post.post_link.toLowerCase()),1)]),_:1},8,["to"])])):h("",!0)])],8,wt),t.comment.children?(i(),m("div",{key:0,ref:"comment_reply_box",class:"comment_reply_box",level:t.level},[(i(!0),m(M,null,j(t.comment.children,c=>(i(),q(y,{key:c.comment_no,comment:c,onReply_comment_event:l.reply_comment_event,onDelete_comment_event:l.delete_comment_event,onView_user_event:l.view_user_event,onRefresh_event:o[14]||(o[14]=L=>n.$emit("refresh_event")),onLoaded:l.comment_loaded,onArchor_event:l.archor_event,level:t.level+1,options:t.options},null,8,["comment","onReply_comment_event","onDelete_comment_event","onView_user_event","onLoaded","onArchor_event","level","options"]))),128))],8,Dt)):h("",!0)],512)])],8,pt)}const It=U(yt,[["render",jt]]);export{It as C,ft as _,Ht as d};
