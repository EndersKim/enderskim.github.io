import{v as w,G as r,a6 as C,a7 as V,o as d,d as p,g as D,e as a,h as f,H as h,J as x,Q as l,aT as F}from"./index-b17261da.js";import{_ as L}from"./PageTitle-c4ca13cf.js";import"./ArrowShape-011a022f.js";/* empty css                                                   *//* empty css                                                  */const A={class:"content"},B={class:"upload_main section"},E={class:"upload_local_part"},I=a("div",{class:"top_box_back"},[a("span",null,"Choose File")],-1),N=["src"],O=a("div",{class:"top_box_text"},[a("span",null,"Choose File")],-1),R=["title"],T=a("div",{class:"top_box_back"},[a("span",null,"Upload")],-1),$=["src"],q=a("div",{class:"top_box_text"},[a("span",null,"Upload")],-1),H={__name:"index",setup(z){const b=w(),c=r(null),u=r(""),_=r(!1),n=r(""),i=r("");function m(s){function t(e){const o=e.lastIndexOf(".");return o>0?e.substring(0,o):e}if((s==null?void 0:s.type.indexOf("image"))===0){c.value=s,u.value=URL.createObjectURL(s),_.value=!1;let e=t(s.name);e=e.replace(/[^a-zA-Z0-9]/g,"_"),e=e.replace(/_{2,}/g,"_"),e=e.replace(/^_|_$/g,""),n.value=e||"untitled"}else l({status:"error",message:"not an image"})}async function k(){if(_.value){console.log("file already uploaded"),l({status:"error",message:"file already uploaded"});return}if(!c.value){console.log("no file"),l({status:"error",message:"no file"});return}if(!n.value){console.log("no img_name"),l({status:"error",message:"no img_name"});return}const s=n.value.replace(/[^a-zA-Z0-9_]/g,"");if(s!==n.value){console.log("img_name contains illegal characters"),l({status:"error",message:"img_name contains illegal characters"}),n.value=s;return}try{const t=new FormData;t.append("fileContent",c.value);const o=(await F.post(window.location.origin+"/assets_server/upload",t,{headers:{"Content-Type":"multipart/form-data",token:b.tokenid,"image-name":n.value}})).data;console.log(o),o.status==="success"?(i.value=o.data.webp,l({status:"success",message:"upload success"}),_.value=!0):l({status:"error",message:o.message})}catch(t){console.log(t),l({status:"error",message:"network error"})}}const g=r(null);function y(){g.value.click()}function U(s){const t=s.target.files[0];m(t)}function v(s){const t=s.clipboardData.items;for(let e=0;e<t.length;e++)if(t[e].type.indexOf("image")===0){const o=t[e].getAsFile();m(o)}}return C(()=>{document.addEventListener("paste",v)}),V(()=>{document.removeEventListener("paste",v)}),(s,t)=>(d(),p("div",A,[D(L,{title:"Upload",children:[{title:"Upload",link:"/laboratory/upload"},{title:"View Upload",link:"/laboratory/view_upload"}]}),a("input",{class:"input_file_element",ref_key:"input_file",ref:g,type:"file",accept:"image/*",onChange:U},null,544),a("div",B,[a("div",E,[a("div",{class:"top_box",onClick:y},[I,u.value?(d(),p("img",{key:0,src:u.value},null,8,N)):f("",!0),O]),h(a("input",{type:"text",class:"kinput","onUpdate:modelValue":t[0]||(t[0]=e=>n.value=e),placeholder:"File Name"},null,512),[[x,n.value]])]),a("div",{class:"upload_net_part",title:i.value},[a("div",{class:"top_box",onClick:k},[T,i.value?(d(),p("img",{key:0,src:i.value},null,8,$)):f("",!0),q]),h(a("input",{type:"text",class:"kinput remote_img_url","onUpdate:modelValue":t[1]||(t[1]=e=>i.value=e),placeholder:"Image URL"},null,512),[[x,i.value]])],8,R)])]))}};export{H as default};
