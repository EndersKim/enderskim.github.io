import{m as L}from"./markdown_to_html_lite-855e1114.js";import{_ as M,q as A,a4 as V,p as r,b as N,N as T,c as h,r as s,o,d as _,e as i,g as d,h as l,t as a,F as u,l as y,w as B,i as D,k as H}from"./index-2969da6f.js";const k="fZodR9XQDSUm21yCkr6zBqiveYah8bt4xsWpHnJE7jL5VG3guMTKNPAwcF",g={};for(let n=0;n<58;n++)g[k[n]]=n;const f=[11,10,3,8,4,6],x=177451812,C=8728348608;function S(n){n=(n^x)+C;var t="CM1  4 1 7  ".split("");for(let e=0;e<6;e++)t[f[e]]=k[Math.floor(n/Math.pow(58,e))%58];return t.join("")}function se(n){var t=0;for(let e=0;e<6;e++)t+=g[n[f[e]]]*Math.pow(58,e);return t-C^x}const R={name:"Comment",components:{Avatar:A,Popper:V},props:{comment:{},level:{default:1},options:{default:()=>({})}},computed:{is_self(){return r().active_character?r().active_character.cid==this.comment.character.cid:!1},is_admin(){return N().settings.active_admin?r().login_info&&r().login_info.user.utype=="admin":!1},display_relative_time(){return T(this.comment.insert_time)}},mounted(){this.$emit("loaded",this)},methods:{markdown_to_html_lite:L,encode_comment_no(n){return S(n)},reply_comment_event(n){this.$emit("reply_comment_event",n)},delete_comment_event(n,t){this.$emit("delete_comment_event",n,t)},view_user_event(n){this.$emit("view_user_event",n)},comment_loaded(n){this.$emit("loaded",n)},archor_event(n){this.$emit("archor_event",n)},comment_action_archor(){this.$emit("archor_event",this)},hightlight_parent_enter(){this.level>2&&(this.$parent.$refs.comment_text_box.classList.add("hightlight"),this.$refs.comment_reply_name.classList.add("hightlight"))},hightlight_parent_leave(){this.level>2&&(this.$parent.$refs.comment_text_box.classList.remove("hightlight"),this.$refs.comment_reply_name.classList.remove("hightlight"))},go_to_parent(){h(this.$parent.$el,!0)},hightlight_children_enter(){this.$refs.comment_reply_box.classList.add("reply_box_hightlight")},hightlight_children_leave(){this.$refs.comment_reply_box.classList.remove("reply_box_hightlight")},go_to_children(){h(this.$refs.comment_reply_box,!0)}}},z=["level"],F={class:"comment_box"},j={key:0,class:"comment_avatar_section"},q={class:"comment_main_section",ref:"comment_main_section"},E=["level"],P={class:"comment_text_top"},G={class:"comment_name"},J={key:0,class:"comment_name_reply"},K={class:"comment_time"},Q={key:0,class:"comment_parent"},U=["innerHTML"],W=["textContent"],X={class:"comment_text"},Y=["innerHTML"],Z=["textContent"],I={class:"comment_action"},O={key:0},p={class:"comment_action_transition"},$={key:0,class:"comment_action_transition"},ee={key:1,class:"comment_action_transition"},te={class:"comment_action_transition comment_action_archor"},ne=["href"],me={key:3},oe=["level"];function _e(n,t,e,ce,ie,m){const v=s("Avatar"),w=s("router-link"),b=s("Comment",!0);return o(),_("div",{class:"comment",level:e.level},[i("div",F,[e.level<=2?(o(),_("div",j,[d(v,{avatar_url:e.comment.character.avatar_url,nickname:e.comment.character.nickname,size:40,class:"big_avatar",onClick:t[0]||(t[0]=c=>m.view_user_event(e.comment.character))},null,8,["avatar_url","nickname"]),d(v,{avatar_url:e.comment.character.avatar_url,nickname:e.comment.character.nickname,size:30,class:"small_avatar",onClick:t[1]||(t[1]=c=>m.view_user_event(e.comment.character))},null,8,["avatar_url","nickname"])])):l("",!0),i("div",q,[i("div",{ref:"comment_text_box",class:"comment_text_box",level:e.level},[i("div",P,[i("div",G,[i("span",{class:"comment_name_span with_underline",onClick:t[2]||(t[2]=c=>m.view_user_event(e.comment.character))},a(e.comment.character.nickname),1),e.level>2||e.comment.parent?(o(),_("span",J,a(n.$text("community.reply_to")),1)):l("",!0),e.level>2?(o(),_("span",{key:1,class:"comment_name_span_parent",ref:"comment_reply_name",onMouseenter:t[3]||(t[3]=c=>m.hightlight_parent_enter()),onMouseleave:t[4]||(t[4]=c=>m.hightlight_parent_leave()),onClick:t[5]||(t[5]=c=>m.go_to_parent())},a(n.$parent.comment.character.nickname),545)):l("",!0),e.comment.parent?(o(),_("span",{key:2,class:"comment_name_span_parent with_underline",onClick:t[6]||(t[6]=c=>m.view_user_event(e.comment.parent.character))},a(e.comment.parent.character.nickname),1)):l("",!0)]),i("span",K,a(e.comment.insert_time),1)]),e.comment.parent?(o(),_("div",Q,[e.comment.parent.md=="1"?(o(),_("div",{key:0,class:"comment_parent_content comment_text_content",innerHTML:m.markdown_to_html_lite(e.comment.parent.content)},null,8,U)):(o(),_("p",{key:1,class:"comment_parent_content comment_text_content",textContent:a(e.comment.parent.content)},null,8,W))])):l("",!0),i("div",X,[e.comment.md=="1"?(o(),_("div",{key:0,class:"comment_text_content",innerHTML:m.markdown_to_html_lite(e.comment.content)},null,8,Y)):(o(),_("p",{key:1,class:"comment_text_content",textContent:a(e.comment.content)},null,8,Z))]),i("div",I,[i("p",null,a(m.display_relative_time),1),e.comment.md=="1"&&m.is_admin?(o(),_("p",O,"MD 格式")):l("",!0),e.comment.children?(o(),_("p",{key:1,class:"reply_count",onMouseenter:t[7]||(t[7]=c=>m.hightlight_children_enter()),onMouseleave:t[8]||(t[8]=c=>m.hightlight_children_leave()),onClick:t[9]||(t[9]=c=>m.go_to_children())},a(e.comment.children.length)+" "+a(e.comment.children.length==1?n.$text("community.reply"):n.$text("community.replies")),33)):l("",!0),e.options.hide_action?l("",!0):(o(),_(u,{key:2},[i("p",p,[i("a",{onClick:t[10]||(t[10]=c=>m.reply_comment_event(e.comment))},a(n.$text("community.reply")),1)]),m.is_self?(o(),_("p",$,[i("a",{onClick:t[11]||(t[11]=c=>m.delete_comment_event(e.comment,e.level))},a(n.$text("community.delete")),1)])):m.is_admin?(o(),_("p",ee,[i("a",{onClick:t[12]||(t[12]=c=>m.delete_comment_event(e.comment,e.level))},a(n.$text("community.delete_others")),1)])):l("",!0),i("p",te,[i("a",{href:"#"+m.encode_comment_no(e.comment.comment_no),onClick:t[13]||(t[13]=c=>m.comment_action_archor())},"#",8,ne)])],64)),e.options.display_post&&e.comment.post?(o(),_("p",me,[y(a(n.$text("community.posted_on"))+" ",1),d(w,{to:"/"+e.comment.post.post_link.toLowerCase()+"#"+m.encode_comment_no(e.comment.comment_no)},{default:B(()=>[y(a(e.comment.post.post_link.toLowerCase()),1)]),_:1},8,["to"])])):l("",!0)])],8,E),e.comment.children?(o(),_("div",{key:0,ref:"comment_reply_box",class:"comment_reply_box",level:e.level},[(o(!0),_(u,null,D(e.comment.children,c=>(o(),H(b,{key:c.comment_no,comment:c,onReply_comment_event:m.reply_comment_event,onDelete_comment_event:m.delete_comment_event,onView_user_event:m.view_user_event,onRefresh_event:t[14]||(t[14]=ae=>n.$emit("refresh_event")),onLoaded:m.comment_loaded,onArchor_event:m.archor_event,level:e.level+1,options:e.options},null,8,["comment","onReply_comment_event","onDelete_comment_event","onView_user_event","onLoaded","onArchor_event","level","options"]))),128))],8,oe)):l("",!0)],512)])],8,z)}const de=M(R,[["render",_e]]);export{de as C,se as d};
