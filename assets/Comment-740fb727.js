import{Y as B,a3 as D,o,d as c,F as d,p as R,t as l,h as a,e as i,k as y,i as b,_ as T,x as j,aa as z,v as u,b as F,X as H,c as f,r as v,g as s,l as C,w as E}from"./index-539a8d41.js";import{m as J}from"./markdown_to_html_lite-855e1114.js";import{_ as x}from"./ZoomableImg-1e2d00f8.js";const w="fZodR9XQDSUm21yCkr6zBqiveYah8bt4xsWpHnJE7jL5VG3guMTKNPAwcF",L={};for(let t=0;t<58;t++)L[w[t]]=t;const M=[11,10,3,8,4,6],A=177451812,V=8728348608;function O(t){t=(t^A)+V;var n="CM1  4 1 7  ".split("");for(let e=0;e<6;e++)n[M[e]]=w[Math.floor(t/Math.pow(58,e))%58];return n.join("")}function xe(t){var n=0;for(let e=0;e<6;e++)n+=L[t[M[e]]]*Math.pow(58,e);return n-V^A}const P={class:"CommentContent"},X=["innerHTML"],Y=["textContent"],q={key:1,style:{height:"10px"}},G={key:2,class:"comment_attachments_box single_image"},K={class:"comment_attachment_item"},Q={key:3,class:"comment_attachments_box multi_image"},U={class:"comment_attachment_item"},W={__name:"CommentContent",props:{comment:Object},setup(t){const{comment:n}=t,e=B([]);return D(()=>{if(n.attachments){let r=[];try{r=JSON.parse(n.attachments)}catch(h){console.log(h)}e.value=r}}),(r,h)=>(o(),c("div",P,[t.comment.content?(o(),c(d,{key:0},[t.comment.md=="1"?(o(),c("div",{key:0,class:"comment_text_content",innerHTML:R(J)(t.comment.content)},null,8,X)):(o(),c("p",{key:1,class:"comment_text_content",textContent:l(t.comment.content)},null,8,Y))],64)):a("",!0),t.comment.content&&e.value.length>0?(o(),c("div",q)):a("",!0),e.value.length===1?(o(),c("div",G,[i("div",K,[e.value[0].type=="image"?(o(),y(x,{key:0,src:e.value[0].src,border_radius:"10px"},null,8,["src"])):a("",!0)])])):a("",!0),e.value.length>=2?(o(),c("div",Q,[(o(!0),c(d,null,b(e.value,m=>(o(),c("div",U,[m.type=="image"?(o(),y(x,{key:0,src:m.src,border_radius:"10px",fit:"cover"},null,8,["src"])):a("",!0)]))),256))])):a("",!0)]))}};const Z={name:"Comment",components:{Avatar:j,Popper:z,CommentContent:W},props:{comment:{},level:{default:1},options:{default:()=>({})}},computed:{is_self(){return u().active_character?u().active_character.cid==this.comment.character.cid:!1},is_admin(){var t;return F().settings.active_admin?((t=u().active_character)==null?void 0:t.ctype)=="admin":!1},display_relative_time(){return H(this.comment.insert_time)}},mounted(){this.$emit("loaded",this)},methods:{encode_comment_no(t){return O(t)},reply_comment_event(t){this.$emit("reply_comment_event",t)},delete_comment_event(t,n){this.$emit("delete_comment_event",t,n)},view_user_event(t){this.$emit("view_user_event",t)},comment_loaded(t){this.$emit("loaded",t)},archor_event(t){this.$emit("archor_event",t)},comment_action_archor(){this.$emit("archor_event",this)},hightlight_parent_enter(){this.level>2&&(this.$parent.$refs.comment_main_box.classList.add("hightlight"),this.$refs.comment_reply_name.classList.add("hightlight"))},hightlight_parent_leave(){this.level>2&&(this.$parent.$refs.comment_main_box.classList.remove("hightlight"),this.$refs.comment_reply_name.classList.remove("hightlight"))},go_to_parent(){f(this.$parent.$el,!0)},hightlight_children_enter(){this.$refs.comment_reply_box.classList.add("reply_box_hightlight")},hightlight_children_leave(){this.$refs.comment_reply_box.classList.remove("reply_box_hightlight")},go_to_children(){f(this.$refs.comment_reply_box,!0)}}},I=["level"],p={class:"comment_box"},$={key:0,class:"comment_avatar_section"},ee={class:"comment_main_section",ref:"comment_main_section"},te=["level"],ne={class:"comment_text_top"},me={class:"comment_name"},oe={key:0,class:"comment_name_reply"},ce={class:"comment_time"},ae={key:0,class:"comment_parent"},_e={class:"comment_action"},ie={key:0},le={class:"comment_action_transition"},se={key:0,class:"comment_action_transition"},re={key:1,class:"comment_action_transition"},ve={class:"comment_action_transition comment_action_archor"},de=["href"],he={key:3},ue=["level"];function ye(t,n,e,r,h,m){const g=v("Avatar"),k=v("CommentContent"),N=v("router-link"),S=v("Comment",!0);return o(),c("div",{class:"comment",level:e.level},[i("div",p,[e.level<=2?(o(),c("div",$,[s(g,{avatar_url:e.comment.character.avatar_url,nickname:e.comment.character.nickname,size:40,class:"big_avatar",onClick:n[0]||(n[0]=_=>m.view_user_event(e.comment.character))},null,8,["avatar_url","nickname"]),s(g,{avatar_url:e.comment.character.avatar_url,nickname:e.comment.character.nickname,size:30,class:"small_avatar",onClick:n[1]||(n[1]=_=>m.view_user_event(e.comment.character))},null,8,["avatar_url","nickname"])])):a("",!0),i("div",ee,[i("div",{ref:"comment_main_box",class:"comment_main_box",level:e.level},[i("div",ne,[i("div",me,[i("span",{class:"comment_name_span with_underline",onClick:n[2]||(n[2]=_=>m.view_user_event(e.comment.character))},l(e.comment.character.nickname),1),e.level>2||e.comment.parent?(o(),c("span",oe,l(t.$text("community.reply_to")),1)):a("",!0),e.level>2?(o(),c("span",{key:1,class:"comment_name_span_parent",ref:"comment_reply_name",onMouseenter:n[3]||(n[3]=_=>m.hightlight_parent_enter()),onMouseleave:n[4]||(n[4]=_=>m.hightlight_parent_leave()),onClick:n[5]||(n[5]=_=>m.go_to_parent())},l(t.$parent.comment.character.nickname),545)):a("",!0),e.comment.parent?(o(),c("span",{key:2,class:"comment_name_span_parent with_underline",onClick:n[6]||(n[6]=_=>m.view_user_event(e.comment.parent.character))},l(e.comment.parent.character.nickname),1)):a("",!0)]),i("span",ce,l(e.comment.insert_time),1)]),e.comment.parent?(o(),c("div",ae,[s(k,{comment:e.comment.parent},null,8,["comment"])])):a("",!0),s(k,{comment:e.comment},null,8,["comment"]),i("div",_e,[i("p",null,l(m.display_relative_time),1),e.comment.md=="1"&&m.is_admin?(o(),c("p",ie,"MD 格式")):a("",!0),e.comment.children?(o(),c("p",{key:1,class:"reply_count",onMouseenter:n[7]||(n[7]=_=>m.hightlight_children_enter()),onMouseleave:n[8]||(n[8]=_=>m.hightlight_children_leave()),onClick:n[9]||(n[9]=_=>m.go_to_children())},l(e.comment.children.length)+" "+l(e.comment.children.length==1?t.$text("community.reply"):t.$text("community.replies")),33)):a("",!0),e.options.hide_action?a("",!0):(o(),c(d,{key:2},[i("p",le,[i("a",{onClick:n[10]||(n[10]=_=>m.reply_comment_event(e.comment))},l(t.$text("community.reply")),1)]),m.is_self?(o(),c("p",se,[i("a",{onClick:n[11]||(n[11]=_=>m.delete_comment_event(e.comment,e.level))},l(t.$text("community.delete")),1)])):m.is_admin?(o(),c("p",re,[i("a",{onClick:n[12]||(n[12]=_=>m.delete_comment_event(e.comment,e.level))},l(t.$text("community.delete_others")),1)])):a("",!0),i("p",ve,[i("a",{href:"#"+m.encode_comment_no(e.comment.comment_no),onClick:n[13]||(n[13]=_=>m.comment_action_archor())},"#",8,de)])],64)),e.options.display_post&&e.comment.post?(o(),c("p",he,[C(l(t.$text("community.posted_on"))+" ",1),s(N,{to:"/"+e.comment.post.post_link.toLowerCase()+"#"+m.encode_comment_no(e.comment.comment_no)},{default:E(()=>[C(l(e.comment.post.post_link.toLowerCase()),1)]),_:1},8,["to"])])):a("",!0)])],8,te),e.comment.children?(o(),c("div",{key:0,ref:"comment_reply_box",class:"comment_reply_box",level:e.level},[(o(!0),c(d,null,b(e.comment.children,_=>(o(),y(S,{key:_.comment_no,comment:_,onReply_comment_event:m.reply_comment_event,onDelete_comment_event:m.delete_comment_event,onView_user_event:m.view_user_event,onRefresh_event:n[14]||(n[14]=ge=>t.$emit("refresh_event")),onLoaded:m.comment_loaded,onArchor_event:m.archor_event,level:e.level+1,options:e.options},null,8,["comment","onReply_comment_event","onDelete_comment_event","onView_user_event","onLoaded","onArchor_event","level","options"]))),128))],8,ue)):a("",!0)],512)])],8,I)}const be=T(Z,[["render",ye]]);export{be as C,W as _,xe as d};
