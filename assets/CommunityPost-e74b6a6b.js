import{C as z,d as R}from"./Comment-c97c1227.js";import{_ as F,o as l,d,e as t,q as J,Q as O,P as E,ak as G,y as H,x as Q,U as j,M as K,p as X,c as w,$ as Y,D as r,z as k,B as A,al as P,m as p,r as c,g as a,h,w as u,t as s,f as Z,T as x,k as T,af as ee,F as U,i as te,H as f,am as oe,l as g,I as b}from"./index-dd97f7dd.js";import{_ as ne}from"./Pagination.vue_vue_type_style_index_0_lang-07d67049.js";import{C as se}from"./CharacterCard-e3678f79.js";import{W as ie}from"./Warning-d284aeb8.js";import{C as ae}from"./Comment-f7c9d2a5.js";const _e={},me={width:"48",height:"48",viewBox:"0 0 48 48",xmlns:"http://www.w3.org/2000/svg"},ce=t("path",{d:"M22.720 2.049 C 18.640 2.424,15.106 4.005,12.288 6.718 C 9.409 9.489,7.671 12.913,7.150 16.840 C 6.972 18.187,7.033 20.764,7.277 22.200 C 7.731 24.862,8.523 27.188,9.920 29.960 C 12.181 34.445,15.588 38.865,20.147 43.225 C 21.799 44.806,22.914 45.729,23.354 45.879 C 24.447 46.252,25.077 45.881,27.843 43.231 C 34.393 36.956,38.688 30.411,40.276 24.280 C 40.806 22.238,40.919 21.317,40.919 19.040 C 40.919 17.263,40.896 16.880,40.741 16.071 C 40.021 12.317,38.404 9.309,35.712 6.718 C 33.203 4.304,30.014 2.731,26.558 2.205 C 25.731 2.079,23.420 1.985,22.720 2.049 M25.442 6.084 C 28.543 6.469,31.110 7.729,33.278 9.930 C 35.110 11.788,36.290 14.063,36.802 16.720 C 36.954 17.510,37.022 19.019,36.952 20.060 C 36.743 23.172,35.519 26.678,33.413 30.200 C 31.437 33.502,28.202 37.441,25.012 40.429 L 23.998 41.378 22.986 40.429 C 18.566 36.286,14.689 31.090,12.830 26.818 C 10.204 20.785,10.429 15.641,13.506 11.335 C 14.362 10.137,15.965 8.664,17.240 7.904 C 19.765 6.398,22.710 5.745,25.442 6.084 M22.320 11.192 C 19.290 11.861,16.979 14.137,16.220 17.200 C 15.983 18.159,15.983 19.841,16.220 20.800 C 16.821 23.223,18.320 25.094,20.520 26.164 C 21.790 26.782,22.427 26.920,24.000 26.920 C 25.573 26.920,26.210 26.782,27.480 26.164 C 29.680 25.094,31.179 23.223,31.780 20.800 C 32.017 19.841,32.017 18.159,31.780 17.200 C 31.179 14.777,29.679 12.905,27.480 11.836 C 26.295 11.260,25.638 11.107,24.200 11.072 C 23.239 11.048,22.865 11.072,22.320 11.192 M24.600 15.042 C 26.163 15.262,27.591 16.599,27.912 18.144 C 28.481 20.883,26.188 23.342,23.420 22.959 C 21.839 22.741,20.412 21.412,20.088 19.856 C 19.576 17.394,21.339 15.147,23.920 14.971 C 23.986 14.967,24.292 14.999,24.600 15.042 "},null,-1),le=[ce];function re(e,o){return l(),d("svg",me,le)}const de=F(_e,[["render",re]]);const ue={components:{Comment:z,Avatar:J,Placeholder:O,PageDialog:E,FormSwitch:G,FormTextarea:H,Pagination:ne,CharacterCard:se,FormButton:Q,Warning:ie,CommentIcon:ae,User:j,Mail:K,Local:de},props:["post_id"],data(){return{post:null,comments:null,post_page:null,order:"recent",active_order:null,form:{content:""},reply_target:null,delete_target:null,comment_info:{nickname:"",email:"",website:"",remember:!0,agree:!1},open_delete_dialog:!1,open_user_dialog:!1,open_write_comment_dialog:!1,write_comment_loading:!1,delete_dialog:{display_content:null,comment_no:null},user_dialog:{},scroll_target:null,active_animation:!1,reload_loading:!1,component_actived:!0}},activated(){this.component_actived=!0},deactivated(){this.component_actived=!1},computed:{Account(){return X()}},mounted(){this.active_animation=!1,this.post_page=this.$route.query.cmpage||1,this.get_post();let e=JSON.parse(localStorage.getItem("comment_info"));e&&(this.comment_info=e)},watch:{post_id:{handler(){this.active_animation=!1,this.reload_loading=!1,this.comments=null,this.post=null,this.post_page=this.$route.query.cmpage||1,this.scroll_target=null,this.get_post()}},"$route.query.cmpage":{handler(){if(!this.component_actived)return;const e=this.$route.query.cmpage||1;e!==this.post_page&&(this.post_page=e,this.scroll_target=this.$el,this.active_animation=!1,this.reload_loading=!0,this.get_post())}}},methods:{archor_event(e){var o;e&&(w(e.$el,!0),(o=e.$refs.comment_text_box)==null||o.classList.add("hightlight"),setTimeout(()=>{var m;(m=e.$refs.comment_text_box)==null||m.classList.remove("hightlight")},1e3))},comment_loaded(e){let o=null;this.$route.hash&&(o=R(this.$route.hash.slice(1))),o==e.comment.comment_no&&(setTimeout(()=>{var m;w(e.$el,!0),(m=e.$refs.comment_text_box)==null||m.classList.add("hightlight")},500),setTimeout(()=>{var m;(m=e.$refs.comment_text_box)==null||m.classList.remove("hightlight")},1500))},async get_post(){const e=await Y("community/get_post.php",{post_id:this.post_id,page:this.post_page});e.status=="success"?(this.post=e.data.post,this.comments=e.data.post_comments,this.$nextTick(()=>{this.get_post_done()})):(this.comments=null,r({message:e.message,status:"error"}))},get_post_done(){this.scroll_target&&(w(this.scroll_target),this.scroll_target=null),this.$nextTick(()=>{this.reload_loading=!1})},async add_comment_action(){this.write_comment_loading=!0;const e="comment_toast_key-"+Math.random();r({message:"评论发表中",status:"loading",key:e}),k("community/new_comment.php",{content:this.form.content.trim(),post_id:this.post_id,tokenid:await A(),cid:this.Account.active_character.cid,device_id:await P(),parent_no:this.reply_target?this.reply_target.comment_no:null}).then(o=>{let m=o;m.status=="success"?(r({message:p("community.post_comment_success"),status:"success",key:e}),this.active_animation=!0,this.get_post(),this.form.content="",this.open_write_comment_dialog=!1,this.write_comment_loading=!1):(console.log(m),this.write_comment_loading=!1,r({message:m.message||m,status:"error"}))})},async add_comment_visitor_action(){this.write_comment_loading=!0,k("community/new_visitor_comment.php",{content:this.form.content.trim(),post_id:this.post_id,nickname:this.comment_info.nickname.trim(),email:this.comment_info.email.trim(),website:this.comment_info.website.trim(),device_id:await P(),parent_no:this.reply_target?this.reply_target.comment_no:null}).then(e=>{let o=e;o.status=="success"?(r({message:p("community.post_comment_success"),status:"success"}),this.active_animation=!0,this.get_post(),this.form.content="",this.open_write_comment_dialog=!1,this.write_comment_loading=!1,this.comment_info.remember&&localStorage.setItem("comment_info",JSON.stringify(this.comment_info))):(console.log(o),this.write_comment_loading=!1,r({message:o.message||o,status:"error"}))})},add_comment_request(){if(this.form.content.trim()==""){r({message:p("community.enter_comment"),status:"error"});return}if(this.Account.active_character)this.add_comment_action();else{if(!this.comment_info.nickname.trim()){r({message:p("account.enter_nickname"),status:"error"});return}if(this.comment_info.agree==!1){r({message:p("account.agree_need"),status:"error"});return}this.add_comment_visitor_action()}},reply_comment_event(e){this.open_write_comment_dialog=!0,this.reply_target=e},delete_comment_event(e){this.open_delete_dialog=!0,this.delete_target=e},async delete_comment_request(){k("community/delete_comment.php",{tokenid:await A(),comment_no:this.delete_target.comment_no}).then(e=>{e.status=="success"?(this.get_post(),this.active_animation=!0,r({status:"success",message:p("community.delete_comment_success")}),this.open_delete_dialog=!1):r({status:"error",message:e.message})})},view_user_event(e){this.open_user_dialog=!0,this.user_dialog=e}}},he={class:"CommunityPost"},ge={key:0,class:"first_loading"},pe={key:0,class:"community_post_section section"},fe={class:"comments_title"},ve={class:"section_title"},ye={class:"comments_count"},Ce={class:"comments_viewer"},we={key:0,class:"comments_tools_box blur_part"},ke={class:"comments_tools"},xe={class:"comments_loading"},be={class:"comments_loading_icon_box"},Ve={key:0,class:"confirm_dialog danger delete_dialog"},Ae={class:"icon_container"},Pe={class:"title_container"},Te={class:"confirm_dialog_title"},Ue={class:"confirm_dialog_text"},Fe={class:"add_comment_reply_target"},$e={class:"add_comment_reply_target_character_name"},Le={class:"add_comment_reply_target_cotent"},Me={class:"button_container"},Se={class:"write_comment_dialog"},qe={key:0,class:"add_comment_character"},Be={class:"character_name"},De=t("div",{style:{flex:"1"}},null,-1),Ie={key:1,class:"add_comment_new_character"},Ne={class:"add_comment_new_character_row"},We={class:"form_rows"},ze={class:"form_row_lable"},Re={class:"text"},Je={class:"form_row_note"},Oe={class:"form_row_lable"},Ee={class:"text"},Ge={class:"form_row_note"},He={class:"form_row_lable"},Qe={class:"text"},je={class:"form_row_note"},Ke=t("div",{style:{height:"14px"}},null,-1),Xe={key:2,class:"add_comment_reply_target"},Ye={class:"add_comment_reply_target_character_name"},Ze={class:"add_comment_reply_target_cotent"},et={class:"add_comment_text"},tt=t("div",{style:{height:"14px"}},null,-1),ot={class:"agree_link"},nt={class:"terms_link",href:"/about/terms",target:"_blank"},st={class:"terms_link",href:"/about/terms",target:"_blank"},it={class:"terms_link",href:"/about/terms",target:"_blank"},at=t("div",{style:{height:"10px"}},null,-1),_t=t("div",{style:{height:"20px"}},null,-1),mt={class:"add_comment_submit"};function ct(e,o,m,lt,n,_){const v=c("Placeholder"),$=c("Comment"),L=c("Pagination"),M=c("CommentIcon"),S=c("Warning"),y=c("FormButton"),C=c("PageDialog"),q=c("CharacterCard"),B=c("Avatar"),D=c("User"),I=c("Mail"),N=c("Local"),V=c("FormSwitch"),W=c("FormTextarea");return l(),d("div",he,[n.comments?h("",!0):(l(),d("div",ge,[a(v,{loading:""})])),a(x,{name:"fade_trans"},{default:u(()=>[n.comments?(l(),d("div",pe,[t("div",fe,[t("h3",ve,s(e.$text("community.comments")),1),t("p",ye,s(n.post&&n.post.comments_count),1)]),t("div",Ce,[t("div",{class:Z(["comments_main",{active_animation:n.active_animation}])},[a(x,{name:"comment_empty_transition"},{default:u(()=>[n.comments&&n.comments.length==0?(l(),T(v,{key:0,empty:n.comments&&n.comments.length==0,empty_title:e.$text("community.no_comments")},null,8,["empty","empty_title"])):h("",!0)]),_:1}),a(ee,{name:"comment_transition",tag:"span"},{default:u(()=>[(l(!0),d(U,null,te(n.comments,i=>(l(),T($,{key:i.comment_no,ref_for:!0,ref:"comment_ref",comment:i,onView_user_event:_.view_user_event,onRefresh_event:o[0]||(o[0]=rt=>_.get_post()),onReply_comment_event:_.reply_comment_event,onDelete_comment_event:_.delete_comment_event,onLoaded:_.comment_loaded,onArchor_event:_.archor_event},null,8,["comment","onView_user_event","onReply_comment_event","onDelete_comment_event","onLoaded","onArchor_event"]))),128))]),_:1})],2),n.post?(l(),d("div",we,[t("div",ke,[a(L,{page_name:"cmpage",max_page:Math.ceil(n.post.comments_count/10)||1},null,8,["max_page"]),t("a",{class:"comments_tools_button",onClick:o[1]||(o[1]=i=>{n.open_write_comment_dialog=!0,n.reply_target=null})},[a(M),t("span",null,s(e.$text("community.post_comment")),1)])])])):h("",!0)]),a(x,{name:"fade_trans"},{default:u(()=>[f(t("div",xe,[t("div",be,[a(v,{loading:""})])],512),[[oe,n.reload_loading]])]),_:1})])):h("",!0)]),_:1}),a(C,{modelValue:n.open_delete_dialog,"onUpdate:modelValue":o[4]||(o[4]=i=>n.open_delete_dialog=i)},{default:u(()=>[n.delete_target?(l(),d("div",Ve,[t("div",Ae,[a(S)]),t("div",Pe,[t("h3",Te,s(e.$text("community.delete_comment_confirm")),1),t("p",Ue,s(e.$text("community.delete_comment_warning")),1)]),t("div",Fe,[t("p",$e,s(n.delete_target.character.nickname),1),t("p",Le,s(n.delete_target.content),1)]),t("div",Me,[a(y,{class:"plain",icon:"cancel",onClick:o[2]||(o[2]=i=>n.open_delete_dialog=!1)},{default:u(()=>[g(s(e.$text("dialog.cancel")),1)]),_:1}),a(y,{class:"danger",icon:"confirm",onClick:o[3]||(o[3]=i=>_.delete_comment_request())},{default:u(()=>[g(s(e.$text("dialog.confirm")),1)]),_:1})])])):h("",!0)]),_:1},8,["modelValue"]),a(C,{modelValue:n.open_user_dialog,"onUpdate:modelValue":o[5]||(o[5]=i=>n.open_user_dialog=i),title:" ",class:"user_dialog"},{default:u(()=>[a(q,{character:n.user_dialog},null,8,["character"])]),_:1},8,["modelValue"]),a(C,{modelValue:n.open_write_comment_dialog,"onUpdate:modelValue":o[15]||(o[15]=i=>n.open_write_comment_dialog=i),title:e.$text("community.write_comment"),loading:n.write_comment_loading},{default:u(()=>[t("div",Se,[_.Account.active_character?(l(),d("div",qe,[a(B,{slot:"reference",avatar_url:_.Account.active_character.avatar_url,nickname:_.Account.active_character.nickname,size:40},null,8,["avatar_url","nickname"]),t("p",Be,s(_.Account.active_character.nickname),1),De])):h("",!0),_.Account.active_character?h("",!0):(l(),d("div",Ie,[t("div",Ne,[t("p",null,[t("a",{onClick:o[6]||(o[6]=i=>_.Account.open_login=!0)},s(e.$text("account.login")),1),g(" , "),t("a",{onClick:o[7]||(o[7]=i=>_.Account.open_register=!0)},s(e.$text("account.register")),1),g(" "+s(e.$text("community.or_guest_comment")),1)])]),t("div",We,[t("div",ze,[a(D),t("div",Re,[t("h4",null,s(e.$text("account.nickname")),1)])]),f(t("input",{class:"kinput","onUpdate:modelValue":o[8]||(o[8]=i=>n.comment_info.nickname=i)},null,512),[[b,n.comment_info.nickname]]),t("ul",Je,[t("li",null,s(e.$text("account.nickname_info")),1)]),t("div",Oe,[a(I),t("div",Ee,[t("h4",null,s(e.$text("account.email")),1)])]),f(t("input",{class:"kinput","onUpdate:modelValue":o[9]||(o[9]=i=>n.comment_info.email=i)},null,512),[[b,n.comment_info.email]]),t("ul",Ge,[t("li",null,s(e.$text("account.email_info_private")),1),t("li",null,s(e.$text("account.email_info_avatar")),1),t("li",null,s(e.$text("account.email_info_replay")),1)]),t("div",He,[a(N),t("div",Qe,[t("h4",null,s(e.$text("account.website")),1)])]),f(t("input",{class:"kinput","onUpdate:modelValue":o[10]||(o[10]=i=>n.comment_info.website=i)},null,512),[[b,n.comment_info.website]]),t("ul",je,[t("li",null,s(e.$text("account.website_info")),1)]),Ke,a(V,{modelValue:n.comment_info.remember,"onUpdate:modelValue":o[11]||(o[11]=i=>n.comment_info.remember=i),on_text:e.$text("account.remember_guest_info"),plain:!0},null,8,["modelValue","on_text"])])])),n.reply_target?(l(),d("div",Xe,[t("p",Ye,s(e.$text("community.reply_to"))+" "+s(n.reply_target.character.nickname),1),t("p",Ze,s(n.reply_target.content),1)])):h("",!0),t("div",et,[a(W,{placeholder:e.$text("community.write_comment"),min_line:5,modelValue:n.form.content,"onUpdate:modelValue":o[12]||(o[12]=i=>n.form.content=i)},null,8,["placeholder","modelValue"])]),_.Account.active_character?h("",!0):(l(),d(U,{key:3},[tt,a(V,{modelValue:n.comment_info.agree,"onUpdate:modelValue":o[13]||(o[13]=i=>n.comment_info.agree=i),on_text:e.$text("account.agree"),plain:!0},null,8,["modelValue","on_text"]),t("p",ot,[g(s(e.$text("account.agree_info0"))+" ",1),t("a",nt,s(e.$text("account.agree_info1")),1),g(" "+s(e.$text("account.agree_info_"))+" ",1),t("a",st,s(e.$text("account.agree_info2")),1),g(" "+s(e.$text("account.agree_info_and"))+" ",1),t("a",it,s(e.$text("account.agree_info3")),1)]),at],64)),_t,t("div",mt,[a(y,{icon:"submit",onClick:o[14]||(o[14]=i=>_.add_comment_request())},{default:u(()=>[g(s(e.$text("community.post_comment")),1)]),_:1})])])]),_:1},8,["modelValue","title","loading"])])}const vt=F(ue,[["render",ct]]);export{vt as C};
