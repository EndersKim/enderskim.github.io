import{D as A,G as v,j as C,o as $,d as U,e as s,f as m,H as _,I as h,g as u,U as B,t as i,p as o,q as t,J as p,N as D,l as y,K as V,O as x,Q as l,$ as Z,R as K,V as f}from"./index-b17261da.js";import{_ as T}from"./FormTextarea-04b99bf5.js";import{C as j}from"./CharacterCard-0e460992.js";import"./UserBusiness-1e7a0f3b.js";const E={class:"Register"},F={class:"register_steps_display"},G=f('<div class="top_part"><div class="line" style="opacity:0;"></div><div class="circle">1</div><div class="line"></div></div><div class="main_part"><h4>用户名</h4><p>取一个独一无二的用户名</p></div>',2),H=[G],I=f('<div class="top_part"><div class="line"></div><div class="circle">2</div><div class="line"></div></div><div class="main_part"><h4>身份认证</h4><p>设置密码等身份认证方式</p></div>',2),J=[I],M=f('<div class="top_part"><div class="line"></div><div class="circle">3</div><div class="line"></div></div><div class="main_part"><h4>用户资料</h4><p>设置用户头像和昵称等</p></div>',2),O=[M],Q=f('<div class="top_part"><div class="line"></div><div class="circle">4</div><div class="line" style="opacity:0;"></div></div><div class="main_part"><h4>完成注册</h4><p>确认资料并且提交注册请求</p></div>',2),L=[Q],P={class:"step_1"},W={class:"form_rows"},X={class:"form_row_lable"},Y={class:"text"},ss=s("ul",{class:"form_row_note"},[s("li",null,"用户名是唯一的"),s("li",null," 用户名要易于分辨，所以不能含有汉字和特殊字符，只能由小写英文字母、数字以及下划线 _ 组成 "),s("li",null,"用户名的长度为 1 至 32 位"),s("li",null,"用户名不可修改")],-1),es=s("div",{style:{height:"20px"}},null,-1),ts={class:"agree_link"},os={class:"terms_link",href:"/about/terms",target:"_blank"},as={class:"terms_link",href:"/about/terms",target:"_blank"},is={class:"terms_link",href:"/about/terms",target:"_blank"},ns={class:"form_buttons_row register_botton_row"},ls=["disabled"],cs={class:"step_2"},rs={class:"form_rows"},_s={class:"form_row_lable"},ds={class:"text"},us={class:"form_row_note"},ps=s("li",null,"建议使用复杂的密码来提高账户的安全性",-1),vs={class:"form_row_lable"},ms={class:"text"},hs={class:"form_row_note"},fs={class:"form_buttons_row register_botton_row"},ws=["disabled"],bs={class:"step_3"},gs={class:"form_rows"},ks={class:"form_row_lable"},ys=s("div",{class:"icon"},null,-1),xs={class:"text"},Cs=["placeholder"],Vs={class:"form_row_lable"},$s=s("div",{class:"icon"},null,-1),Us={class:"text"},Ns={class:"form_row_lable"},Rs=s("div",{class:"icon"},null,-1),zs={class:"text"},Ss=["placeholder"],qs={class:"form_row_note"},As={class:"form_row_lable"},Bs=s("div",{class:"icon"},null,-1),Ds={class:"text"},Zs=["placeholder"],Ks={class:"form_row_note"},Ts={class:"form_buttons_row register_botton_row"},js={class:"step_4"},Es=s("p",{class:"register_comfirm_text"}," 您即将创建的用户信息如下，请在提交注册请求前确认无误 ",-1),Fs={class:"form_buttons_row register_botton_row"},Gs=["disabled"],Hs={__name:"Register",setup(N){const w=A(),c=v(1),e=C({agree:!1,uid:"",password:"",repeat_password:"",info:{nickname:"",descr:"",email:"",website:""}}),d=C({ctype:null,cid:"",nickname:"",descr:"",email:"",avatar_url:"",website:""}),b=v(!1);function R(){b.value=!0,x("account/register_check_uid.php",{uid:e.uid}).then(r=>{if(b.value=!1,r.status=="success")c.value=2;else switch(r.message){case"uid_too_short":l({message:t("account.uid_too_short"),status:"error"});break;case"uid_too_long":l({message:t("account.uid_too_long"),status:"error"});break;case"uid_invalid_characters":l({message:t("account.uid_invalid_characters"),status:"error"});break;case"uid_is_used":l({message:t("account.uid_is_used"),status:"error"});break}})}const g=v(!1);function z(){if(e.password.length<3){l({message:t("account.password_too_short"),status:"error"});return}if(e.password!=e.repeat_password){l({message:t("account.password_repeat_same"),status:"error"});return}g.value=!0,x("account/register_check_password.php",{password:e.password}).then(r=>{if(g.value=!1,r.status==="success")c.value=3;else switch(r.message){case"password_too_short":l({message:t("account.password_too_short"),status:"error"});break}})}function S(){if(e.info.email&&!/^[a-zA-Z0-9_-]+@[a-zA-Z0-9_-]+(\.[a-zA-Z0-9_-]+)+$/.test(e.info.email)){l({message:"邮箱地址格式不正确",status:"error"});return}if(e.info.website&&!/^https?:\/\/.+$/.test(e.info.website)){l({message:"网站地址格式不正确，需要以 http:// 或 https:// 开头",status:"error"});return}e.info.nickname||(e.info.nickname=e.uid),d.cid=e.uid,d.nickname=e.info.nickname,d.descr=e.info.descr,d.website=e.info.website,d.avatar_url="",c.value=4,e.info.email&&Z("account/get_avatar_from_email.php",{email:e.info.email}).then(r=>{r.status=="success"?d.avatar_url=r.data:console.error(r.message)})}const k=v(!1);async function q(){k.value=!0;const r=await x("account/register.php",{uid:e.uid,password:e.password,nickname:e.info.nickname||"",email:e.info.email||"",website:e.info.website||"",descr:e.info.descr||""});if(k.value=!1,console.log(r),r.status!="success")switch(r.message){case"uid_too_short":l({showClose:!0,message:t("account.uid_too_short"),status:"error"});break;case"uid_too_long":l({showClose:!0,message:t("account.uid_too_long"),status:"error"});break;case"uid_invalid_characters":l({showClose:!0,message:t("account.uid_invalid_characters"),status:"error"});break;case"uid_is_used":l({showClose:!0,message:t("account.uid_is_used"),status:"error"});break;case"password_too_short":l({showClose:!0,message:t("account.password_too_short"),status:"error"});break;default:l({showClose:!0,message:response.message,status:"error"});break}else l({showClose:!0,message:t("account.register_success"),status:"success"}),w.push("/account/overview"),K(r.data.tokenid)}return(r,a)=>($(),U("form",E,[s("div",F,[s("div",{class:m(["step_item",{active:c.value==1}])},H,2),s("div",{class:m(["step_item",{active:c.value==2}])},J,2),s("div",{class:m(["step_item",{active:c.value==3}])},O,2),s("div",{class:m(["step_item",{active:c.value==4}])},L,2)]),_(s("div",P,[s("div",W,[s("div",X,[u(B),s("div",Y,[s("h4",null,i(o(t)("account.uid")),1)])]),_(s("input",{class:"kinput","onUpdate:modelValue":a[0]||(a[0]=n=>e.uid=n),autocomplete:"uid"},null,512),[[p,e.uid]]),ss]),es,u(D,{modelValue:e.agree,"onUpdate:modelValue":a[1]||(a[1]=n=>e.agree=n),on_text:o(t)("account.agree"),plain:!0},null,8,["modelValue","on_text"]),s("p",ts,[y(i(o(t)("account.agree_info0"))+" ",1),s("a",os,i(o(t)("account.agree_info1")),1),y(" "+i(o(t)("account.agree_info_"))+" ",1),s("a",as,i(o(t)("account.agree_info2")),1),y(" "+i(o(t)("account.agree_info_and"))+" ",1),s("a",is,i(o(t)("account.agree_info3")),1)]),s("div",ns,[s("button",{type:"button",class:"kbutton",onClick:R,disabled:b.value||!e.uid||!e.agree}," 下一步 ",8,ls)])],512),[[h,c.value==1]]),_(s("div",cs,[s("div",rs,[s("div",_s,[u(V),s("div",ds,[s("h4",null,i(o(t)("account.password")),1)])]),_(s("input",{class:"kinput",type:"password","onUpdate:modelValue":a[2]||(a[2]=n=>e.password=n),autocomplete:"new-password"},null,512),[[p,e.password]]),s("ul",us,[s("li",null,i(o(t)("account.password_info")),1),ps]),s("div",vs,[u(V),s("div",ms,[s("h4",null,i(o(t)("account.password_repeat")),1)])]),_(s("input",{class:"kinput",type:"password","onUpdate:modelValue":a[3]||(a[3]=n=>e.repeat_password=n),autocomplete:"new-password"},null,512),[[p,e.repeat_password]]),s("ul",hs,[s("li",null,i(o(t)("account.password_repeat_info")),1)])]),s("div",fs,[s("button",{type:"button",class:"kbutton plain",onClick:a[4]||(a[4]=n=>c.value=1)}," 上一步 "),s("button",{type:"button",class:"kbutton",onClick:z,disabled:g.value||!e.password||!e.repeat_password}," 下一步 ",8,ws)])],512),[[h,c.value==2]]),_(s("div",bs,[s("div",gs,[s("div",ks,[ys,s("div",xs,[s("h4",null,i(o(t)("account.nickname")),1)])]),_(s("input",{class:"kinput","onUpdate:modelValue":a[5]||(a[5]=n=>e.info.nickname=n),placeholder:o(t)("account.nickname_default")},null,8,Cs),[[p,e.info.nickname]]),s("div",Vs,[$s,s("div",Us,[s("h4",null,i(o(t)("account.intro")),1)])]),u(T,{modelValue:e.info.descr,"onUpdate:modelValue":a[6]||(a[6]=n=>e.info.descr=n),placeholder:o(t)("account.no_intro")},null,8,["modelValue","placeholder"]),s("div",Ns,[Rs,s("div",zs,[s("h4",null,i(o(t)("account.email")),1)])]),_(s("input",{class:"kinput","onUpdate:modelValue":a[7]||(a[7]=n=>e.info.email=n),placeholder:o(t)("account.no_email")},null,8,Ss),[[p,e.info.email]]),s("ul",qs,[s("li",null,i(o(t)("account.email_info_private")),1),s("li",null,i(o(t)("account.email_info_avatar")),1),s("li",null,i(o(t)("account.email_info_replay")),1)]),s("div",As,[Bs,s("div",Ds,[s("h4",null,i(o(t)("account.website")),1)])]),_(s("input",{class:"kinput","onUpdate:modelValue":a[8]||(a[8]=n=>e.info.website=n),placeholder:o(t)("account.no_website")},null,8,Zs),[[p,e.info.website]]),s("ul",Ks,[s("li",null,i(o(t)("account.website_info")),1)])]),s("div",Ts,[s("button",{type:"button",class:"kbutton plain",onClick:a[9]||(a[9]=n=>c.value=2)}," 上一步 "),s("button",{type:"button",class:"kbutton",onClick:S}," 下一步 ")])],512),[[h,c.value==3]]),_(s("div",js,[Es,u(j,{character:d},null,8,["character"]),s("div",Fs,[s("button",{type:"button",class:"kbutton plain",onClick:a[10]||(a[10]=n=>c.value=3)}," 上一步 "),s("button",{type:"button",class:"kbutton",onClick:a[11]||(a[11]=n=>q()),disabled:k.value},i(o(t)("account.create_account")),9,Gs)])],512),[[h,c.value==4]])]))}};const Is={class:"account_section_register"},Js={class:"section_title"},Ms=s("div",{style:{height:"30px"}},null,-1),Ws={__name:"register",setup(N){return(w,c)=>($(),U("div",Is,[s("h2",Js,i(w.$text("account.create_account")),1),Ms,u(Hs)]))}};export{Ws as default};
