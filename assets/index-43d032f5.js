import{v as N,Y as o,a4 as z,o as t,d as a,e as s,g,w as x,S as k,t as c,O as J,Q as O,h as V,F as i,i as b,f,J as w}from"./index-b89d1eee.js";const M={class:"content"},A={class:"chat_box"},D={class:"chat_box_aside"},F=s("div",{class:"chat_box_title"},[s("h1",null,"消息")],-1),U={class:"chat_rooms"},$=["onClick"],j={class:"img_box"},E=["src"],L={class:"text_box"},Q={class:"title"},T={class:"intro"},W={key:0,class:"chat_box_main section"},Y={class:"chat_room_title"},q={class:"chat_room_main"},G={class:"msg_part"},H={class:"msg_display"},I={class:"msg_item_avatar"},K=["src"],P={class:"msg_item_main"},R={class:"msg_item_name"},X={class:"msg_item_box"},Z={class:"msg_item_avatar"},ss=["src"],es={class:"msg_item_main"},ts={class:"msg_item_name"},as={class:"msg_item_box"},cs=s("div",{class:"msg_item_avatar"},null,-1),ns={class:"msg_item_main"},ls={class:"msg_item_name"},os={class:"msg_item_box"},is={class:"msg_input"},_s={class:"user_part"},ds=s("div",{class:"user_part_title"},[s("h3",null,"当前在线")],-1),rs={class:"user_part_list"},us={class:"user_avatar"},vs=["src"],hs={class:"user_text"},ps={class:"name"},ms={class:"id"},gs=s("div",{class:"user_avatar"},[s("svg",{viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg",width:"200",height:"200"},[s("path",{d:"M819.292 623.785c-40.844-40.844-88.387-72.547-140.151-94.102 69.587-51.392 114.809-133.97 114.809-226.921 0-155.467-126.483-281.951-281.951-281.951s-281.951 126.483-281.951 281.951c0 92.95 45.221 175.529 114.809 226.921-51.762 21.555-99.308 53.26-140.151 94.102-82.080 82.080-127.284 191.213-127.284 307.292 0 32.174 26.082 58.254 58.254 58.254s58.254-26.080 58.254-58.254c0-175.385 142.685-318.068 318.068-318.068 175.385 0 318.068 142.685 318.068 318.068 0 32.174 26.080 58.254 58.254 58.254s58.254-26.080 58.254-58.254c0-116.081-45.204-225.211-127.284-307.292zM512 137.32c91.225 0 165.442 74.218 165.442 165.442s-74.218 165.442-165.442 165.442-165.442-74.218-165.442-165.442 74.218-165.442 165.442-165.442z"})])],-1),xs={class:"user_text"},ks=s("p",{class:"name"},"匿名用户",-1),bs={class:"id"},Ss={__name:"index",setup(fs){const r=N(),_=o(null),y=o([{title:"公共频道",intro:"这里消息对所有人可见",img:"https://pic1.zhimg.com/v2-8d5ebb4f0fa67e76cbdd3c468f596e98_r.jpg"}]),d=o(null),v=o([]),u=o([]);o(!1);const h=o({});function S(n){_.value?(d.value=null,p()):(d.value=n,C())}function C(){const n=new WebSocket("ws://127.0.0.1:12001");console.log("websocket 连接中"),n.onopen=()=>{console.log("websocket 已连接"),w({status:"success",message:"已连接",group:"websocket"});let l={nickname:"游客",avatar_url:"/static/img/login.svg",cno:0};r.active_character&&(l.nickname=r.active_character.nickname,l.avatar_url=r.active_character.avatar_url,l.cno=r.active_character.cno);let e={type:"define_user",data:{user:l}};n.send(JSON.stringify(e)),_.value=n},n.onclose=()=>{console.log("websocket 连接已关闭"),w({status:"error",message:"连接已断开",group:"websocket"}),d.value=null,_.value=null},n.onerror=l=>{},n.onmessage=l=>{let e=JSON.parse(l.data);switch(console.log(e),e.type){case"client_id":h.value.client_id=e.data.client_id;break;case"user_enter":u.value.push({type:"text",user:e.data.user,client_id:e.data.client_id,text:"用户进入频道"}),v.value=e.data.online_users;break;case"user_leave":u.value.push({type:"text",user:e.data.user,client_id:e.data.client_id,text:"用户离开频道"}),v.value=e.data.online_users;break;case"send_text":u.value.push({type:"text",user:e.data.user,client_id:e.data.client_id,text:e.data.text});break}}}function p(){if(!_.value)return;console.log("websocket 正在断开"),_.value.close()}z(()=>{p()});const m=o("");function B(){let n={type:"broadcast",data:{text:m.value}};_.value.send(JSON.stringify(n))}return(n,l)=>(t(),a("div",M,[s("div",A,[s("div",D,[F,s("div",U,[g(k,null,{default:x(()=>[(t(!0),a(i,null,b(y.value,e=>(t(),a("div",{class:f(["chat_room_item",{active:e==d.value}]),onClick:ws=>S(e)},[s("div",j,[s("img",{src:e.img},null,8,E)]),s("div",L,[s("p",Q,c(e.title),1),s("p",T,c(e.intro),1)])],10,$))),256))]),_:1})])]),d.value&&_.value?(t(),a("div",W,[s("div",Y,[s("h2",null,c(d.value.title),1),s("a",{onClick:p}," 退出 ")]),s("div",q,[s("div",G,[s("div",H,[g(k,null,{default:x(()=>[(t(!0),a(i,null,b(u.value,e=>(t(),a("div",{class:f(["msg_item",{self:e.client_id==h.value.client_id}])},[e.user&&e.type=="text"?(t(),a(i,{key:0},[s("div",I,[s("img",{src:e.user.avatar_url},null,8,K)]),s("div",P,[s("div",R,[s("p",null,c(e.user.nickname)+" ("+c(e.client_id)+") ",1)]),s("div",X,[s("p",null,c(e.text),1)])])],64)):e.user&&(e.type=="user_enter"||e.type=="user_leave")?(t(),a(i,{key:1},[s("div",Z,[s("img",{src:e.user.avatar_url},null,8,ss)]),s("div",es,[s("div",ts,[s("p",null,c(e.user.nickname),1)]),s("div",as,[s("p",null,c(e.type=="user_enter"?"进入":"退出"),1)])])],64)):(t(),a(i,{key:2},[cs,s("div",ns,[s("div",ls,[s("p",null,c(e.client_id),1)]),s("div",os,[s("p",null,c(e.text),1)])])],64))],2))),256))]),_:1})]),s("div",is,[J(s("textarea",{class:"kinput ktextarea","onUpdate:modelValue":l[0]||(l[0]=e=>m.value=e)},null,512),[[O,m.value]]),s("button",{class:"kbutton",onClick:B}," ↑ ")])]),s("div",_s,[ds,s("div",rs,[g(k,null,{default:x(()=>[(t(!0),a(i,null,b(v.value,e=>(t(),a("div",{class:f(["user_item",{self:e.id==h.value.client_id}])},[e&&e.user?(t(),a(i,{key:0},[s("div",us,[s("img",{src:e.user.avatar_url},null,8,vs)]),s("div",hs,[s("p",ps,c(e.user.nickname),1),s("p",ms,c(e.id),1)])],64)):(t(),a(i,{key:1},[gs,s("div",xs,[ks,s("p",bs,c(e.id),1)])],64))],2))),256))]),_:1})])])])])):V("",!0)])]))}};export{Ss as default};
