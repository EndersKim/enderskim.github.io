import{ai as Y,Y as k,o as l,d as m,e as c,aj as G,p as q,f as z,n as F,a3 as K,F as M,t as h,h as r,k as A,i as P,_ as Q,x as U,aa as W,v as S,b as tt,X as et,c as N,r as L,g as C,l as j,w as nt}from"./index-b89d1eee.js";import{m as ot}from"./markdown_to_html_lite-855e1114.js";const Z="fZodR9XQDSUm21yCkr6zBqiveYah8bt4xsWpHnJE7jL5VG3guMTKNPAwcF",H={};for(let n=0;n<58;n++)H[Z[n]]=n;const I=[11,10,3,8,4,6],E=177451812,J=8728348608;function at(n){n=(n^E)+J;var o="CM1  4 1 7  ".split("");for(let t=0;t<6;t++)o[I[t]]=Z[Math.floor(n/Math.pow(58,t))%58];return o.join("")}function Jt(n){var o=0;for(let t=0;t<6;t++)o+=H[n[I[t]]]*Math.pow(58,t);return o-J^E}const lt={class:"ZoomableImg"},it=["src","alt"],mt=["src"],st=c("div",{class:"full_view_overlay blur_part"},null,-1),ct=["src"],_t={class:"full_img_box"},rt=["src"],D={__name:"ZoomableImg",props:{src:{type:String,required:!0},alt:{type:String,default:"image"},border_radius:{type:String,default:"0"},fit:{type:String,default:"unset"}},setup(n){const o=n,t=Y(),_=k("closed");let f=null;const a=k(null),x=k(null);function b(){const e=a.value.getBoundingClientRect(),i=x.value.getBoundingClientRect(),u={width:e.width,height:e.height,left:e.left,top:e.top,actual_width:e.width,actual_height:e.height,actual_left:e.left,actual_top:e.top,left_right_margin:0,top_bottom_margin:0},d=i.width/i.height,p=e.width/e.height;if(o.fit=="cover")if(d>p){const v=e.height*d,g=(v-e.width)/2;u.actual_width=v,u.left_right_margin=g,u.actual_left=e.left-g}else{const v=e.width/d,g=(v-e.height)/2;u.actual_height=v,u.top_bottom_margin=g,u.actual_top=e.top-g}return u}function w(){const e=x.value.getBoundingClientRect();return{width:e.width,height:e.height,left:e.left,top:e.top}}const y=k({}),s=k({});$();function $(){y.value={opacity:0},s.value={opacity:0}}function B(){const e=b(),i=w(),u=e.actual_left-i.left,d=e.actual_top-i.top,p=e.actual_width/i.width,v=e.actual_height/i.height,g={left:e.left_right_margin/p,right:e.left_right_margin/p,top:e.top_bottom_margin/v,bottom:e.top_bottom_margin/v};return{"clip-path":`inset(${g.top}px ${g.right}px ${g.bottom}px ${g.left}px round calc(${o.border_radius} / ${p}) )`,transform:`translate(${u}px, ${d}px) scale(${p}, ${v})`,width:i.width+"px",height:i.height+"px",left:i.left+"px",top:i.top+"px"}}function T(){const e=w();return{"clip-path":"inset(0 0 0 0 round 0)",transform:"translate(0, 0) scale(1, 1)",width:e.width+"px",height:e.height+"px",left:e.left+"px",top:e.top+"px"}}function R(){const e=b(),i=w(),u=i.width/e.actual_width,d=i.height/e.actual_height,p=i.left-e.actual_left,v=i.top-e.actual_top;return{left:-e.left_right_margin+"px",right:-e.left_right_margin+"px",top:-e.top_bottom_margin+"px",bottom:-e.top_bottom_margin+"px","clip-path":"inset(0 0 0 0 round 0)",transform:`translate(${p}px, ${v}px) scale(${u}, ${d})`}}function V(){const e=b(),i={left:e.left_right_margin,right:e.left_right_margin,top:e.top_bottom_margin,bottom:e.top_bottom_margin};return{left:-e.left_right_margin+"px",right:-e.left_right_margin+"px",top:-e.top_bottom_margin+"px",bottom:-e.top_bottom_margin+"px","clip-path":`inset(${i.top}px ${i.right}px ${i.bottom}px ${i.left}px round calc(${o.border_radius}) )`,transform:"translate(0, 0) scale(1, 1)"}}function O(){if(_.value==="opning"||_.value==="opened")return;const e=B(),i=T(),u=V(),d=R();y.value={opacity:0,...e},s.value={opacity:1,...u},requestAnimationFrame(()=>{y.value={transition:"0.3s, opacity 0.15s",opacity:1,...i},s.value={transition:"0.3s, opacity 0.15s 0.15s",opacity:0,...d}}),_.value="opening",clearTimeout(f),f=setTimeout(()=>{_.value="opened",$()},300)}function X(){if(_.value==="closing"||_.value==="closed")return;const e=B(),i=T(),u=R(),d=V();_.value==="opened"&&(y.value={opacity:1,...i},s.value={opacity:0,...u}),requestAnimationFrame(()=>{y.value={transition:"0.3s, opacity 0.15s 0.15s",opacity:0,...e},s.value={transition:"0.3s, opacity 0.15s",opacity:1,...d}}),_.value="closing",clearTimeout(f),f=setTimeout(()=>{_.value="closed",$()},300)}return(e,i)=>(l(),m("div",lt,[c("img",G({class:["small_img_item",_.value],ref_key:"small_img_el",ref:a,src:n.src,alt:n.alt,style:{objectFit:n.fit,clipPath:"inset(0 0 0 0 round "+n.border_radius+")"},onClick:O},q(t)),null,16,it),(l(),m("div",{key:0,class:z(["small_trans_box",_.value]),style:F(s.value)},[c("img",{class:"small_trans_item",src:n.src},null,8,mt)],6)),c("div",{class:z(["zoomable_img_full",_.value]),onClick:X},[st,(l(),m("div",{key:0,class:"full_trans_box",style:F(y.value)},[c("img",{class:"full_trans_item",src:n.src},null,8,ct)],4)),c("div",_t,[c("img",{src:n.src,ref_key:"full_img_el",ref:x,class:"full_img_item"},null,8,rt)])],2)]))}};const ut={class:"CommentContent"},ht=["innerHTML"],dt=["textContent"],vt={key:1,class:"comment_content_attachments_space"},gt={key:2,class:"comment_attachments_box single_image"},ft={class:"comment_attachment_item"},yt={key:3,class:"comment_attachments_box multi_image"},pt={class:"comment_attachment_item"},xt={__name:"CommentContent",props:{comment:Object},setup(n){const{comment:o}=n,t=k([]);return K(()=>{if(o.attachments){let _=[];try{_=JSON.parse(o.attachments)}catch(f){console.log(f)}t.value=_}}),(_,f)=>(l(),m("div",ut,[n.comment.content?(l(),m(M,{key:0},[n.comment.md=="1"?(l(),m("div",{key:0,class:"comment_text_content",innerHTML:q(ot)(n.comment.content)},null,8,ht)):(l(),m("p",{key:1,class:"comment_text_content",textContent:h(n.comment.content)},null,8,dt))],64)):r("",!0),n.comment.content&&t.value.length>0?(l(),m("div",vt)):r("",!0),t.value.length===1?(l(),m("div",gt,[c("div",ft,[t.value[0].type=="image"?(l(),A(D,{key:0,class:"comment_attachment_img",src:t.value[0].src,border_radius:"10px"},null,8,["src"])):r("",!0)])])):r("",!0),t.value.length>=2?(l(),m("div",yt,[(l(!0),m(M,null,P(t.value,a=>(l(),m("div",pt,[a.type=="image"?(l(),A(D,{key:0,class:"comment_attachment_img",src:a.src,border_radius:"10px",fit:"cover"},null,8,["src"])):r("",!0)]))),256))])):r("",!0)]))}};const bt={name:"Comment",components:{Avatar:U,Popper:W,CommentContent:xt},props:{comment:{},level:{default:1},options:{default:()=>({})}},computed:{is_self(){return S().active_character?S().active_character.cid==this.comment.character.cid:!1},is_admin(){var n;return tt().settings.active_admin?((n=S().active_character)==null?void 0:n.ctype)=="admin":!1},display_relative_time(){return et(this.comment.insert_time)}},mounted(){this.$emit("loaded",this)},methods:{encode_comment_no(n){return at(n)},reply_comment_event(n){this.$emit("reply_comment_event",n)},delete_comment_event(n,o){this.$emit("delete_comment_event",n,o)},view_user_event(n){this.$emit("view_user_event",n)},comment_loaded(n){this.$emit("loaded",n)},archor_event(n){this.$emit("archor_event",n)},comment_action_archor(){this.$emit("archor_event",this)},hightlight_parent_enter(){this.level>2&&(this.$parent.$refs.comment_main_box.classList.add("hightlight"),this.$refs.comment_reply_name.classList.add("hightlight"))},hightlight_parent_leave(){this.level>2&&(this.$parent.$refs.comment_main_box.classList.remove("hightlight"),this.$refs.comment_reply_name.classList.remove("hightlight"))},go_to_parent(){N(this.$parent.$el,!0)},hightlight_children_enter(){this.$refs.comment_reply_box.classList.add("reply_box_hightlight")},hightlight_children_leave(){this.$refs.comment_reply_box.classList.remove("reply_box_hightlight")},go_to_children(){N(this.$refs.comment_reply_box,!0)}}},kt=["level"],wt={class:"comment_box"},Ct={key:0,class:"comment_avatar_section"},$t={class:"comment_main_section",ref:"comment_main_section"},Lt=["level"],Mt={class:"comment_text_top"},St={class:"comment_name"},At={key:0,class:"comment_name_reply"},Bt={class:"comment_time"},Tt={key:0,class:"comment_parent"},Rt={class:"comment_action"},Vt={key:0},zt={class:"comment_action_transition"},Ft={key:0,class:"comment_action_transition"},Nt={key:1,class:"comment_action_transition"},jt={class:"comment_action_transition comment_action_archor"},Dt=["href"],qt={key:3},Pt=["level"];function Zt(n,o,t,_,f,a){const x=L("Avatar"),b=L("CommentContent"),w=L("router-link"),y=L("Comment",!0);return l(),m("div",{class:"comment",level:t.level},[c("div",wt,[t.level<=2?(l(),m("div",Ct,[C(x,{avatar_url:t.comment.character.avatar_url,nickname:t.comment.character.nickname,size:40,class:"big_avatar",onClick:o[0]||(o[0]=s=>a.view_user_event(t.comment.character))},null,8,["avatar_url","nickname"]),C(x,{avatar_url:t.comment.character.avatar_url,nickname:t.comment.character.nickname,size:30,class:"small_avatar",onClick:o[1]||(o[1]=s=>a.view_user_event(t.comment.character))},null,8,["avatar_url","nickname"])])):r("",!0),c("div",$t,[c("div",{ref:"comment_main_box",class:"comment_main_box",level:t.level},[c("div",Mt,[c("div",St,[c("span",{class:"comment_name_span with_underline",onClick:o[2]||(o[2]=s=>a.view_user_event(t.comment.character))},h(t.comment.character.nickname),1),t.level>2||t.comment.parent?(l(),m("span",At,h(n.$text("community.reply_to")),1)):r("",!0),t.level>2?(l(),m("span",{key:1,class:"comment_name_span_parent",ref:"comment_reply_name",onMouseenter:o[3]||(o[3]=s=>a.hightlight_parent_enter()),onMouseleave:o[4]||(o[4]=s=>a.hightlight_parent_leave()),onClick:o[5]||(o[5]=s=>a.go_to_parent())},h(n.$parent.comment.character.nickname),545)):r("",!0),t.comment.parent?(l(),m("span",{key:2,class:"comment_name_span_parent with_underline",onClick:o[6]||(o[6]=s=>a.view_user_event(t.comment.parent.character))},h(t.comment.parent.character.nickname),1)):r("",!0)]),c("span",Bt,h(t.comment.insert_time),1)]),t.comment.parent?(l(),m("div",Tt,[C(b,{comment:t.comment.parent},null,8,["comment"])])):r("",!0),C(b,{comment:t.comment},null,8,["comment"]),c("div",Rt,[c("p",null,h(a.display_relative_time),1),t.comment.md=="1"&&a.is_admin?(l(),m("p",Vt,"MD 格式")):r("",!0),t.comment.children?(l(),m("p",{key:1,class:"reply_count",onMouseenter:o[7]||(o[7]=s=>a.hightlight_children_enter()),onMouseleave:o[8]||(o[8]=s=>a.hightlight_children_leave()),onClick:o[9]||(o[9]=s=>a.go_to_children())},h(t.comment.children.length)+" "+h(t.comment.children.length==1?n.$text("community.reply"):n.$text("community.replies")),33)):r("",!0),t.options.hide_action?r("",!0):(l(),m(M,{key:2},[c("p",zt,[c("a",{onClick:o[10]||(o[10]=s=>a.reply_comment_event(t.comment))},h(n.$text("community.reply")),1)]),a.is_self?(l(),m("p",Ft,[c("a",{onClick:o[11]||(o[11]=s=>a.delete_comment_event(t.comment,t.level))},h(n.$text("community.delete")),1)])):a.is_admin?(l(),m("p",Nt,[c("a",{onClick:o[12]||(o[12]=s=>a.delete_comment_event(t.comment,t.level))},h(n.$text("community.delete_others")),1)])):r("",!0),c("p",jt,[c("a",{href:"#"+a.encode_comment_no(t.comment.comment_no),onClick:o[13]||(o[13]=s=>a.comment_action_archor())},"#",8,Dt)])],64)),t.options.display_post&&t.comment.post?(l(),m("p",qt,[j(h(n.$text("community.posted_on"))+" ",1),C(w,{to:"/"+t.comment.post.post_link.toLowerCase()+"#"+a.encode_comment_no(t.comment.comment_no)},{default:nt(()=>[j(h(t.comment.post.post_link.toLowerCase()),1)]),_:1},8,["to"])])):r("",!0)])],8,Lt),t.comment.children?(l(),m("div",{key:0,ref:"comment_reply_box",class:"comment_reply_box",level:t.level},[(l(!0),m(M,null,P(t.comment.children,s=>(l(),A(y,{key:s.comment_no,comment:s,onReply_comment_event:a.reply_comment_event,onDelete_comment_event:a.delete_comment_event,onView_user_event:a.view_user_event,onRefresh_event:o[14]||(o[14]=$=>n.$emit("refresh_event")),onLoaded:a.comment_loaded,onArchor_event:a.archor_event,level:t.level+1,options:t.options},null,8,["comment","onReply_comment_event","onDelete_comment_event","onView_user_event","onLoaded","onArchor_event","level","options"]))),128))],8,Pt)):r("",!0)],512)])],8,kt)}const Ot=Q(bt,[["render",Zt]]);export{Ot as C,xt as _,Jt as d};
