import{aG as $}from"./index-b17261da.js";function O(a){const e=a.split(":"),r=e[0],n=e[1];let c=Math.round((r*60+n*1)*1e3);return e.length==3&&(c+=e[2]*10),c}function I(a,e,r){const n=new Map;e&&e.split(`
`).forEach(i=>{let t=i.substring(i.indexOf("[")+1,i.indexOf("]")),s=O(t),l=i.substring(i.indexOf("]")+1);n.set(s,l)});const c=new Map;r&&r.split(`
`).forEach(i=>{let t=i.substring(i.indexOf("[")+1,i.indexOf("]")),s=O(t),l=i.substring(i.indexOf("]")+1);c.set(s,l)});let f=[];return a.split(`
`).forEach(i=>{let t=i.trim(),s=[];for(;t.indexOf("[")==0&&t.indexOf("]")>=0;){let l=t.substring(t.indexOf("[")+1,t.indexOf("]")),o=O(l);s.push(o),t=t.substring(t.indexOf("]")+1).trim()}s.forEach(l=>{if(!Object.is(l,NaN)){let o={time:l/1e3,text:t,translate:n.get(s[0]),roma:c.get(s[0])};f.push(o)}})}),f.sort((i,t)=>i.time-t.time),f}function v(a){const e=a.split(":"),r=e[0],n=e[1];let c=Math.round((r*60+n*1)*1e3);return e.length==3&&(c+=e[2]*10),c}function F(a,e,r){const n=new Map;e&&e.split(`
`).forEach(t=>{let s=t.substring(t.indexOf("[")+1,t.indexOf("]")),l=v(s),o=t.substring(t.indexOf("]")+1);n.set(l,o)});const c=new Map;r&&r.split(`
`).forEach(t=>{let s=t.substring(t.indexOf("[")+1,t.indexOf("]")),l=v(s),o=t.substring(t.indexOf("]")+1);c.set(l,o)});let f=[];a.split(`
`).forEach(t=>{if(t.indexOf("[")<0)return;let l=t.substring(t.indexOf("[")+1,t.indexOf("]")).split(","),o=l[0]*1,m=t.substring(t.indexOf("]")+1).split("("),h=[],p="";m.forEach(u=>{if(u.indexOf(")")<0)return;let _={},x=u.substring(0,u.indexOf(")"));_.w_text=u.substring(u.indexOf(")")+1).replaceAll(" ","&nbsp;");let g=x.split(",")[0];_.w_start=g/1e3,_.w_duration=x.split(",")[1]/1e3,_.data=x.split(",")[2],h.push(_),p+=_.w_text}),h.length>0&&f.push({time:l[0]/1e3,duration:l[1]/1e3,text:p,words:h,translate:n.get(o),roma:c.get(o)})});let i=f.length;for(let t=0;t<i-1;t++){const s=f[t],l=f[t+1];let o=(s.time+s.duration).toFixed(2)*1,d=(l.time-s.time-s.duration).toFixed(2)*1;d>1&&f.push({time:o,duration:d})}return f.sort((t,s)=>t.time-s.time),f}function w(a){return a.replace(/\{\{Photrans2\|(.+?)\|(.+?)\}\}/g,(e,r,n)=>`<div class='ruby'>
			<div class='pr'>${n}</div>
			<div class='tx'>${r}</div>
			</div>`).replace(/\{\{photrans\|(.+?)\|(.+?)\}\}/g,(e,r,n)=>`<div class='ruby'>
			<div class='pr'>${n}</div>
			<div class='tx'>${r}</div>
			</div>`)}function E(a){if(!a)return[];const e=[];return a.split(`
`).forEach(r=>{const n=[],c=r.match(/@(\d+)([^@]*)/g),f=r.match(/^[^@]+/g);if(f){const i=f[0].trim();i&&n.push({chara_id:0,text:w(i)})}c&&c.forEach(i=>{const t=i.replace(/@\d+/,"").trim();n.push({chara_id:i.match(/@(\d+)/)[1],text:w(t)})}),e.push(n)}),e}function y(a){if(!a)return[];const e=[];let r=0;return a.split(`
`).forEach(n=>{const c=n.match(/\[(.+?)\]/);if(c){const f=$(c[1]);r=f,e.push(f)}else e.push(r)}),e}function b(a){var e=parseInt(a.slice(1,3),16),r=parseInt(a.slice(3,5),16),n=parseInt(a.slice(5,7),16),c=.299*e+.587*r+.114*n;return c>128?"#000":"#fff"}function M(a){if(!a)return[];let e="★",r="var(--text-color)",n="var(--section-color)";if(!a)return[{chara_id:0,name:e,color:`linear-gradient(${r}, ${r})`,text_color:n}];const c=a.split(`
`),f=c[0],i=c[1];c.slice(2).forEach(l=>{console.log("chara_setting_line",l);const o=l.match(/(.+)\:\s*(.+)/);if(!o)return;const d=o[1].trim(),m=o[2].trim();switch(d){case"color":r=m,n=b(m);break;case"name":e=m;break}});const s=[];if(s.push({chara_id:0,name:e,color:`linear-gradient(${r}, ${r})`,text_color:n}),a){const l=i.split("；"),o=f.split(";");l.forEach((d,m)=>{if(!d)return;const h=o[m].trim();let p,u;const _=h.match(/lg\(([^,]+),\s*([^)]+)\)/);if(_){const x=_[1].trim(),g=_[2].trim();p=`linear-gradient(to right, ${x}, ${g})`,u=b(x)}else p=`linear-gradient(${h}, ${h})`,u=b(h);s.push({chara_id:m+1,name:l[m],color:p,text_color:u})})}return s}function N(a,e,r,n){const c=M(a),f=y(e),i=E(r),t=E(n),s=[];return i.forEach((l,o)=>{s.push({time:f[o]||60*99,text:i[o]||[],translate:t[o]||[]})}),{characters:c,rows:s}}export{F as a,N as b,I as p};
