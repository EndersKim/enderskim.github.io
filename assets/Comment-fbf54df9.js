import{Y as N,a3 as S,o,d as a,F as h,p as B,t as l,h as i,f as D,i as C,_ as z,x as R,aa as T,v as u,b as j,X as F,c as k,r as v,e as _,g as s,l as f,w as H,k as E}from"./index-7b0ed318.js";import{m as J}from"./markdown_to_html_lite-855e1114.js";const x="fZodR9XQDSUm21yCkr6zBqiveYah8bt4xsWpHnJE7jL5VG3guMTKNPAwcF",w={};for(let t=0;t<58;t++)w[x[t]]=t;const b=[11,10,3,8,4,6],L=177451812,M=8728348608;function O(t){t=(t^L)+M;var n="CM1  4 1 7  ".split("");for(let e=0;e<6;e++)n[b[e]]=x[Math.floor(t/Math.pow(58,e))%58];return n.join("")}function ke(t){var n=0;for(let e=0;e<6;e++)n+=w[t[b[e]]]*Math.pow(58,e);return n-M^L}const P={class:"CommentContent"},X=["innerHTML"],Y=["textContent"],q={key:1,style:{height:"10px"}},G={class:"comment_attachment_item"},K=["src"],Q={__name:"CommentContent",props:{comment:Object},setup(t){const{comment:n}=t,e=N([]);return S(()=>{if(n.attachments){let r=[];try{r=JSON.parse(n.attachments)}catch(d){console.log(d)}e.value=r}}),(r,d)=>(o(),a("div",P,[t.comment.content?(o(),a(h,{key:0},[t.comment.md=="1"?(o(),a("div",{key:0,class:"comment_text_content",innerHTML:B(J)(t.comment.content)},null,8,X)):(o(),a("p",{key:1,class:"comment_text_content",textContent:l(t.comment.content)},null,8,Y))],64)):i("",!0),t.comment.content&&e.value.length>0?(o(),a("div",q)):i("",!0),e.value.length>0?(o(),a("div",{key:2,class:D(["comment_attachments_box",{single_image:e.value.length==1,multi_image:e.value.length>1}])},[(o(!0),a(h,null,C(e.value,m=>(o(),a("div",G,[m.type=="image"?(o(),a("img",{key:0,class:"comment_attachment_image",src:m.src},null,8,K)):i("",!0)]))),256))],2)):i("",!0)]))}};const U={name:"Comment",components:{Avatar:R,Popper:T,CommentContent:Q},props:{comment:{},level:{default:1},options:{default:()=>({})}},computed:{is_self(){return u().active_character?u().active_character.cid==this.comment.character.cid:!1},is_admin(){var t;return j().settings.active_admin?((t=u().active_character)==null?void 0:t.ctype)=="admin":!1},display_relative_time(){return F(this.comment.insert_time)}},mounted(){this.$emit("loaded",this)},methods:{encode_comment_no(t){return O(t)},reply_comment_event(t){this.$emit("reply_comment_event",t)},delete_comment_event(t,n){this.$emit("delete_comment_event",t,n)},view_user_event(t){this.$emit("view_user_event",t)},comment_loaded(t){this.$emit("loaded",t)},archor_event(t){this.$emit("archor_event",t)},comment_action_archor(){this.$emit("archor_event",this)},hightlight_parent_enter(){this.level>2&&(this.$parent.$refs.comment_main_box.classList.add("hightlight"),this.$refs.comment_reply_name.classList.add("hightlight"))},hightlight_parent_leave(){this.level>2&&(this.$parent.$refs.comment_main_box.classList.remove("hightlight"),this.$refs.comment_reply_name.classList.remove("hightlight"))},go_to_parent(){k(this.$parent.$el,!0)},hightlight_children_enter(){this.$refs.comment_reply_box.classList.add("reply_box_hightlight")},hightlight_children_leave(){this.$refs.comment_reply_box.classList.remove("reply_box_hightlight")},go_to_children(){k(this.$refs.comment_reply_box,!0)}}},W=["level"],Z={class:"comment_box"},I={key:0,class:"comment_avatar_section"},p={class:"comment_main_section",ref:"comment_main_section"},$=["level"],ee={class:"comment_text_top"},te={class:"comment_name"},ne={key:0,class:"comment_name_reply"},me={class:"comment_time"},oe={key:0,class:"comment_parent"},ae={class:"comment_action"},ce={key:0},_e={class:"comment_action_transition"},ie={key:0,class:"comment_action_transition"},le={key:1,class:"comment_action_transition"},se={class:"comment_action_transition comment_action_archor"},re=["href"],ve={key:3},he=["level"];function de(t,n,e,r,d,m){const y=v("Avatar"),g=v("CommentContent"),A=v("router-link"),V=v("Comment",!0);return o(),a("div",{class:"comment",level:e.level},[_("div",Z,[e.level<=2?(o(),a("div",I,[s(y,{avatar_url:e.comment.character.avatar_url,nickname:e.comment.character.nickname,size:40,class:"big_avatar",onClick:n[0]||(n[0]=c=>m.view_user_event(e.comment.character))},null,8,["avatar_url","nickname"]),s(y,{avatar_url:e.comment.character.avatar_url,nickname:e.comment.character.nickname,size:30,class:"small_avatar",onClick:n[1]||(n[1]=c=>m.view_user_event(e.comment.character))},null,8,["avatar_url","nickname"])])):i("",!0),_("div",p,[_("div",{ref:"comment_main_box",class:"comment_main_box",level:e.level},[_("div",ee,[_("div",te,[_("span",{class:"comment_name_span with_underline",onClick:n[2]||(n[2]=c=>m.view_user_event(e.comment.character))},l(e.comment.character.nickname),1),e.level>2||e.comment.parent?(o(),a("span",ne,l(t.$text("community.reply_to")),1)):i("",!0),e.level>2?(o(),a("span",{key:1,class:"comment_name_span_parent",ref:"comment_reply_name",onMouseenter:n[3]||(n[3]=c=>m.hightlight_parent_enter()),onMouseleave:n[4]||(n[4]=c=>m.hightlight_parent_leave()),onClick:n[5]||(n[5]=c=>m.go_to_parent())},l(t.$parent.comment.character.nickname),545)):i("",!0),e.comment.parent?(o(),a("span",{key:2,class:"comment_name_span_parent with_underline",onClick:n[6]||(n[6]=c=>m.view_user_event(e.comment.parent.character))},l(e.comment.parent.character.nickname),1)):i("",!0)]),_("span",me,l(e.comment.insert_time),1)]),e.comment.parent?(o(),a("div",oe,[s(g,{comment:e.comment.parent},null,8,["comment"])])):i("",!0),s(g,{comment:e.comment},null,8,["comment"]),_("div",ae,[_("p",null,l(m.display_relative_time),1),e.comment.md=="1"&&m.is_admin?(o(),a("p",ce,"MD 格式")):i("",!0),e.comment.children?(o(),a("p",{key:1,class:"reply_count",onMouseenter:n[7]||(n[7]=c=>m.hightlight_children_enter()),onMouseleave:n[8]||(n[8]=c=>m.hightlight_children_leave()),onClick:n[9]||(n[9]=c=>m.go_to_children())},l(e.comment.children.length)+" "+l(e.comment.children.length==1?t.$text("community.reply"):t.$text("community.replies")),33)):i("",!0),e.options.hide_action?i("",!0):(o(),a(h,{key:2},[_("p",_e,[_("a",{onClick:n[10]||(n[10]=c=>m.reply_comment_event(e.comment))},l(t.$text("community.reply")),1)]),m.is_self?(o(),a("p",ie,[_("a",{onClick:n[11]||(n[11]=c=>m.delete_comment_event(e.comment,e.level))},l(t.$text("community.delete")),1)])):m.is_admin?(o(),a("p",le,[_("a",{onClick:n[12]||(n[12]=c=>m.delete_comment_event(e.comment,e.level))},l(t.$text("community.delete_others")),1)])):i("",!0),_("p",se,[_("a",{href:"#"+m.encode_comment_no(e.comment.comment_no),onClick:n[13]||(n[13]=c=>m.comment_action_archor())},"#",8,re)])],64)),e.options.display_post&&e.comment.post?(o(),a("p",ve,[f(l(t.$text("community.posted_on"))+" ",1),s(A,{to:"/"+e.comment.post.post_link.toLowerCase()+"#"+m.encode_comment_no(e.comment.comment_no)},{default:H(()=>[f(l(e.comment.post.post_link.toLowerCase()),1)]),_:1},8,["to"])])):i("",!0)])],8,$),e.comment.children?(o(),a("div",{key:0,ref:"comment_reply_box",class:"comment_reply_box",level:e.level},[(o(!0),a(h,null,C(e.comment.children,c=>(o(),E(V,{key:c.comment_no,comment:c,onReply_comment_event:m.reply_comment_event,onDelete_comment_event:m.delete_comment_event,onView_user_event:m.view_user_event,onRefresh_event:n[14]||(n[14]=ue=>t.$emit("refresh_event")),onLoaded:m.comment_loaded,onArchor_event:m.archor_event,level:e.level+1,options:e.options},null,8,["comment","onReply_comment_event","onDelete_comment_event","onView_user_event","onLoaded","onArchor_event","level","options"]))),128))],8,he)):i("",!0)],512)])],8,W)}const fe=z(U,[["render",de]]);export{fe as C,Q as _,ke as d};
